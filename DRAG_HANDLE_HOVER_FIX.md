# 拖拽手柄悬停交互和菜单定位修复

## 问题
1. 鼠标悬停在块上时，拖拽手柄不显示
2. 鼠标悬停在拖拽手柄上时，菜单不自动打开
3. 只有在编辑状态点击时才能看到拖拽手柄和菜单
4. 菜单在视口边缘时会被遮挡，无法完整显示

## 根本原因
1. **CSS 问题**：`.hide` 类使用了 `!important`，导致 JS 无法正确控制显示状态
2. **事件处理问题**：`mousemove` 中检测到鼠标在拖拽手柄上时直接 `return`，导致位置和内容没有更新
3. **指针事件问题**：隐藏时没有正确管理 `pointer-events`，导致鼠标事件无法触发
4. **菜单定位问题**：菜单定位逻辑简单，没有考虑视口边界和多种显示位置

## 修复内容

### 1. custom-drag-handle.ts

#### 显示/隐藏逻辑优化
- `hideDragHandle()`: 隐藏时设置 `pointerEvents = 'none'`
- `showDragHandle()`: 显示时设置 `pointerEvents = 'auto'`
- `mousemove` 事件：移除鼠标在拖拽手柄上时的 `return`，继续处理以更新位置

#### 菜单定位算法重构
- **智能位置选择**：优先级为 左侧 > 右侧 > 下方 > 上方
- **边界检测**：检查每个方向的可用空间
- **自动调整**：
  - 左侧/右侧显示时，垂直方向自动调整避免超出顶部/底部
  - 上方/下方显示时，水平方向自动调整避免超出左侧/右侧
  - 所有方向都不够时，强制显示在视口内
- **安全边距**：菜单与视口边缘保持 16px 的最小间距

### 2. drag-handle-menu.tsx
- 添加滚动监听：页面滚动时自动关闭菜单，避免菜单位置错位

### 3. drag-handle.css
- 移除 `.hide` 类中的 `!important`，让 JS 能正确控制
- 调整 `pointer-events` 从 `auto !important` 改为 `auto`
- 优化过渡动画时间

## 预期效果
- ✅ 鼠标悬停在任何块上时，拖拽手柄立即显示
- ✅ 鼠标悬停在拖拽手柄上 200ms 后，菜单自动打开
- ✅ 鼠标移开时，延迟 300ms 后关闭（给用户时间移动到菜单）
- ✅ 阅读模式和编辑模式都能正常工作
- ✅ 菜单始终完整显示在视口内，不会被遮挡
- ✅ 菜单根据可用空间智能选择显示位置
- ✅ 页面滚动时菜单自动关闭，避免位置错位

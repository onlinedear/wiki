# é£ä¹¦çŸ¥è¯†åº“å­æ–‡æ¡£å¯¼å…¥è¯´æ˜

## é—®é¢˜åˆ†æ

é£ä¹¦çš„æ–‡æ¡£ç»“æ„æœ‰ä¸¤ç§ç±»å‹ï¼š

### 1. çŸ¥è¯†åº“æ–‡æ¡£æ ‘ï¼ˆWikiï¼‰

```
ğŸ“„ Chat èŠå¤©
  ğŸ“„ æ¨¡å‹é€‰æ‹©
  ğŸ“„ Autopilot
```

è¿™ç§ç»“æ„ä¸­ï¼Œå­æ–‡æ¡£ä¸åœ¨çˆ¶æ–‡æ¡£çš„ blocks ä¸­ï¼Œè€Œæ˜¯åœ¨é£ä¹¦çš„çŸ¥è¯†åº“æ ‘ç»“æ„ä¸­ã€‚

### 2. æ–‡æ¡£å†…å¼•ç”¨

åœ¨æ–‡æ¡£å†…å®¹ä¸­æ’å…¥å…¶ä»–æ–‡æ¡£çš„é“¾æ¥æˆ–å¼•ç”¨ã€‚

## è§£å†³æ–¹æ¡ˆ

æ›´æ–°äº† `getChildDocuments` æ–¹æ³•ï¼Œä½¿ç”¨ä¸‰ç§æ–¹å¼è·å–å­æ–‡æ¡£ï¼š

### æ–¹æ³• 1ï¼šWiki APIï¼ˆçŸ¥è¯†åº“ï¼‰

```typescript
POST /wiki/v2/spaces/get_node
{
  "token": "document_token"
}

// å¦‚æœæœ‰å­èŠ‚ç‚¹
POST /wiki/v2/spaces/list
{
  "parent_node_token": "node_token",
  "page_size": 50
}
```

**é€‚ç”¨åœºæ™¯**ï¼šçŸ¥è¯†åº“æ–‡æ¡£æ ‘ç»“æ„

### æ–¹æ³• 2ï¼šDrive APIï¼ˆäº‘ç©ºé—´ï¼‰

```typescript
GET /drive/v1/files/{token}/children?page_size=50
```

**é€‚ç”¨åœºæ™¯**ï¼šäº‘ç©ºé—´æ–‡ä»¶å¤¹ç»“æ„

### æ–¹æ³• 3ï¼šBlocks APIï¼ˆæ–‡æ¡£å¼•ç”¨ï¼‰

ä»æ–‡æ¡£çš„ blocks ä¸­æŸ¥æ‰¾æ–‡æ¡£é“¾æ¥å’Œå¼•ç”¨ã€‚

**é€‚ç”¨åœºæ™¯**ï¼šæ–‡æ¡£å†…å®¹ä¸­çš„æ–‡æ¡£å¼•ç”¨

## æƒé™è¦æ±‚

éœ€è¦é¢å¤–çš„ API æƒé™ï¼š

### Wiki API æƒé™
- `wiki:wiki:readonly` - æŸ¥çœ‹çŸ¥è¯†åº“

### Drive API æƒé™
- `drive:drive:readonly` - æŸ¥çœ‹äº‘ç©ºé—´æ–‡ä»¶ï¼ˆå·²æœ‰ï¼‰

## æµ‹è¯•æ­¥éª¤

### 1. é‡å¯æœåŠ¡å™¨

```bash
# åœæ­¢å½“å‰æœåŠ¡å™¨ï¼ˆCtrl+Cï¼‰
pnpm dev
```

### 2. é…ç½®æƒé™

è®¿é—®é£ä¹¦å¼€æ”¾å¹³å°ï¼š
```
https://open.feishu.cn/app/ä½ çš„AppID/auth
```

ç¡®è®¤å·²å¼€é€šï¼š
- âœ… `docx:document:readonly` - æŸ¥çœ‹æ–‡æ¡£
- âœ… `drive:drive:readonly` - æŸ¥çœ‹äº‘ç©ºé—´
- âš ï¸ `wiki:wiki:readonly` - æŸ¥çœ‹çŸ¥è¯†åº“ï¼ˆæ–°å¢ï¼‰

### 3. æ‰§è¡Œå¯¼å…¥

1. è®¿é—® NoteDoc
2. å¯¼å…¥"Chat èŠå¤©"æ–‡æ¡£
3. æŸ¥çœ‹æ—¥å¿—è¾“å‡º

### 4. æŸ¥çœ‹æ—¥å¿—

```bash
tail -f apps/server/logs/app.log | grep "ğŸ“š"
```

**æœŸæœ›çœ‹åˆ°çš„æ—¥å¿—**ï¼š

```
ğŸ“š Fetching child documents for token: xxxxx
ğŸ“š Trying wiki API: /wiki/v2/spaces/get_node
ğŸ“š Found wiki node: {"node_token":"...","has_child":true}
ğŸ“š Node has children, fetching child list...
ğŸ“š Found 2 children via wiki API
ğŸ“š Found 2 child documents for xxxxx
ğŸ“š Child document tokens: token1, token2
ğŸ“š Importing child document 1/2: æ¨¡å‹é€‰æ‹© (token1)
ğŸ“š Importing child document 2/2: Autopilot (token2)
```

## å¯èƒ½çš„ç»“æœ

### åœºæ™¯ 1ï¼šWiki API æˆåŠŸ

```
ğŸ“š Found 2 children via wiki API
```

â†’ åŠŸèƒ½æ­£å¸¸ï¼Œå­æ–‡æ¡£ä¼šè¢«å¯¼å…¥

### åœºæ™¯ 2ï¼šWiki API æƒé™ä¸è¶³

```
ğŸ“š Wiki API failed: Request failed with status code 403
ğŸ“š Trying drive API...
```

â†’ éœ€è¦é…ç½® `wiki:wiki:readonly` æƒé™

### åœºæ™¯ 3ï¼šDrive API æˆåŠŸ

```
ğŸ“š Drive API failed: ...
ğŸ“š Found 2 children via drive API
```

â†’ ä½¿ç”¨äº‘ç©ºé—´ API è·å–å­æ–‡æ¡£

### åœºæ™¯ 4ï¼šæ‰€æœ‰ API éƒ½å¤±è´¥

```
ğŸ“š Wiki API failed: ...
ğŸ“š Drive API failed: ...
ğŸ“š No child documents found
```

â†’ å¯èƒ½éœ€è¦å…¶ä»– API æˆ–æƒé™

## API å“åº”ç¤ºä¾‹

### Wiki API å“åº”

```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "node": {
      "node_token": "wikcnxxxxx",
      "obj_token": "doccnxxxxx",
      "obj_type": "docx",
      "parent_node_token": "wikcnyyyyy",
      "has_child": true,
      "title": "Chat èŠå¤©"
    }
  }
}
```

### Wiki List å“åº”

```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "items": [
      {
        "node_token": "wikcn11111",
        "obj_token": "doccn11111",
        "obj_type": "docx",
        "title": "æ¨¡å‹é€‰æ‹©"
      },
      {
        "node_token": "wikcn22222",
        "obj_token": "doccn22222",
        "obj_type": "docx",
        "title": "Autopilot"
      }
    ]
  }
}
```

## è°ƒè¯•å‘½ä»¤

```bash
# æŸ¥çœ‹æ‰€æœ‰å­æ–‡æ¡£æ—¥å¿—
grep "ğŸ“š" apps/server/logs/app.log

# æŸ¥çœ‹ Wiki API è°ƒç”¨
grep "wiki API" apps/server/logs/app.log

# æŸ¥çœ‹ Drive API è°ƒç”¨
grep "drive API" apps/server/logs/app.log

# æŸ¥çœ‹æ‰¾åˆ°çš„å­æ–‡æ¡£
grep "Found.*children via" apps/server/logs/app.log
```

## ä¸‹ä¸€æ­¥

1. **é‡å¯æœåŠ¡å™¨**
2. **é…ç½® Wiki æƒé™**ï¼ˆå¦‚æœéœ€è¦ï¼‰
3. **é‡æ–°å¯¼å…¥æ–‡æ¡£**
4. **æŸ¥çœ‹æ—¥å¿—è¾“å‡º**
5. **æ ¹æ®æ—¥å¿—ç»“æœè°ƒæ•´**

## å‚è€ƒæ–‡æ¡£

- é£ä¹¦ Wiki APIï¼šhttps://open.feishu.cn/document/server-docs/docs/wiki-v2/space-node/get_node
- é£ä¹¦ Drive APIï¼šhttps://open.feishu.cn/document/server-docs/docs/drive-v1/file/list

---

**åˆ›å»ºæ—¶é—´**ï¼š2025-11-26  
**çŠ¶æ€**ï¼šå·²æ›´æ–°ä»£ç ï¼Œç­‰å¾…æµ‹è¯•

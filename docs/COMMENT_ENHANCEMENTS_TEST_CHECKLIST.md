# 评论功能增强测试清单

## 🎯 测试目标

验证所有新增的评论功能是否正常工作，包括搜索、反应、提及和通知系统。

## 📋 测试前准备

### 1. 运行数据库迁移
```bash
./scripts/run-comment-enhancements-migration.sh
```

### 2. 启动开发服务器
```bash
# 终端 1 - 后端
cd apps/server
npm run dev

# 终端 2 - 前端
cd apps/client
npm run dev
```

### 3. 准备测试数据
- [ ] 至少 2 个测试用户账号
- [ ] 至少 1 个测试工作空间
- [ ] 至少 1 个测试页面
- [ ] 至少 5 条测试评论

---

## 🧪 功能测试

### A. 评论搜索功能 (Search)

#### A1. 基础搜索
- [ ] 打开任意页面的评论面板
- [ ] 在搜索框中输入关键词（如"测试"）
- [ ] 点击"搜索"按钮
- [ ] **预期结果**：显示包含关键词的评论

#### A2. 状态过滤
- [ ] 选择状态过滤器："未解决"
- [ ] 点击"搜索"
- [ ] **预期结果**：只显示未解决的评论
- [ ] 选择状态过滤器："已解决"
- [ ] 点击"搜索"
- [ ] **预期结果**：只显示已解决的评论

#### A3. 清除搜索
- [ ] 执行一次搜索
- [ ] 点击"清除"按钮
- [ ] **预期结果**：搜索框清空，显示所有评论

#### A4. 回车搜索
- [ ] 在搜索框中输入关键词
- [ ] 按 Enter 键
- [ ] **预期结果**：执行搜索，无需点击按钮

#### A5. 空搜索
- [ ] 不输入任何内容
- [ ] 点击"搜索"
- [ ] **预期结果**：显示所有评论

---

### B. 评论反应功能 (Reactions)

#### B1. 添加反应
- [ ] 找到任意评论
- [ ] 点击 👍 (赞) 图标
- [ ] **预期结果**：
  - 图标变为填充状态
  - 显示数字 "1"
  - 图标颜色变为蓝色

#### B2. 移除反应
- [ ] 在已添加反应的评论上
- [ ] 再次点击相同的反应图标
- [ ] **预期结果**：
  - 图标变回未填充状态
  - 数字消失或减 1
  - 图标颜色变回灰色

#### B3. 多种反应
- [ ] 在同一评论上依次点击：
  - 👍 赞
  - ❤️ 喜欢
  - 😄 大笑
- [ ] **预期结果**：每个反应都正确显示和计数

#### B4. 多用户反应
- [ ] 用户 A 对评论添加 👍
- [ ] 用户 B 对同一评论添加 👍
- [ ] **预期结果**：显示数字 "2"

#### B5. 反应持久化
- [ ] 添加反应后刷新页面
- [ ] **预期结果**：反应仍然存在

#### B6. 反应权限
- [ ] 尝试对没有权限的页面评论添加反应
- [ ] **预期结果**：显示权限错误或按钮禁用

---

### C. @提及功能 (Mentions)

#### C1. 创建提及
- [ ] 创建新评论
- [ ] 输入 `@[userId](userName)` 格式
- [ ] 发送评论
- [ ] **预期结果**：评论成功创建

#### C2. 提及通知
- [ ] 用户 A 在评论中提及用户 B
- [ ] 切换到用户 B 账号
- [ ] 查看通知图标
- [ ] **预期结果**：
  - 显示未读通知徽章
  - 通知列表中有提及通知
  - 通知文本："[用户名] 在评论中提到了你"

#### C3. 多个提及
- [ ] 在一条评论中提及多个用户
- [ ] **预期结果**：所有被提及用户都收到通知

#### C4. 自我提及
- [ ] 在评论中提及自己
- [ ] **预期结果**：不会收到通知

---

### D. 通知系统 (Notifications)

#### D1. 通知图标
- [ ] 查看顶部导航栏
- [ ] **预期结果**：
  - 显示铃铛图标
  - 有未读通知时显示红色徽章
  - 徽章显示未读数量

#### D2. 打开通知面板
- [ ] 点击通知图标
- [ ] **预期结果**：
  - 弹出通知面板
  - 显示通知列表
  - 显示"未读"和"全部"标签

#### D3. 回复通知
- [ ] 用户 A 创建评论
- [ ] 用户 B 回复该评论
- [ ] 切换到用户 A
- [ ] 查看通知
- [ ] **预期结果**：
  - 收到回复通知
  - 通知文本："[用户名] 回复了你的评论"
  - 显示页面标题

#### D4. 反应通知
- [ ] 用户 A 创建评论
- [ ] 用户 B 对该评论添加反应
- [ ] 切换到用户 A
- [ ] 查看通知
- [ ] **预期结果**：
  - 收到反应通知
  - 通知文本："[用户名] 对你的评论做出了反应"

#### D5. 点击通知跳转
- [ ] 点击任意通知项
- [ ] **预期结果**：
  - 跳转到相关页面
  - 滚动到对应评论
  - 通知标记为已读
  - 通知面板关闭

#### D6. 标记单个已读
- [ ] 点击未读通知
- [ ] **预期结果**：
  - 通知背景色变化（从蓝色到白色）
  - 未读计数减 1

#### D7. 全部标记已读
- [ ] 有多个未读通知时
- [ ] 点击"全部标记为已读"按钮
- [ ] **预期结果**：
  - 所有通知标记为已读
  - 未读徽章消失
  - 未读计数变为 0

#### D8. 未读/全部切换
- [ ] 点击"未读"标签
- [ ] **预期结果**：只显示未读通知
- [ ] 点击"全部"标签
- [ ] **预期结果**：显示所有通知

#### D9. 空通知状态
- [ ] 标记所有通知为已读
- [ ] 切换到"未读"标签
- [ ] **预期结果**：显示"没有未读通知"

#### D10. 通知自动刷新
- [ ] 打开通知面板
- [ ] 等待 30 秒
- [ ] **预期结果**：通知列表自动刷新

#### D11. 通知时间显示
- [ ] 查看通知列表
- [ ] **预期结果**：
  - 显示相对时间（如"5分钟前"）
  - 时间格式正确

---

### E. 集成测试

#### E1. 完整工作流 - 评论讨论
1. [ ] 用户 A 创建评论："这个功能很好"
2. [ ] 用户 B 回复："我同意"
3. [ ] 用户 A 收到回复通知
4. [ ] 用户 A 点击通知跳转
5. [ ] 用户 A 对用户 B 的回复添加 👍
6. [ ] 用户 B 收到反应通知
7. [ ] **预期结果**：所有步骤正常工作

#### E2. 完整工作流 - 提及讨论
1. [ ] 用户 A 创建评论并提及用户 B
2. [ ] 用户 B 收到提及通知
3. [ ] 用户 B 点击通知查看
4. [ ] 用户 B 回复评论
5. [ ] 用户 A 收到回复通知
6. [ ] **预期结果**：所有步骤正常工作

#### E3. 搜索已反应的评论
1. [ ] 对多条评论添加反应
2. [ ] 使用搜索功能查找这些评论
3. [ ] **预期结果**：
   - 搜索结果正确
   - 反应仍然显示

#### E4. 解决评论后的通知
1. [ ] 创建评论
2. [ ] 收到回复
3. [ ] 解决评论
4. [ ] **预期结果**：
   - 通知仍然可见
   - 可以通过通知跳转到已解决的评论

---

### F. 性能测试

#### F1. 大量评论搜索
- [ ] 页面有 50+ 条评论
- [ ] 执行搜索
- [ ] **预期结果**：
  - 搜索响应时间 < 2 秒
  - 结果正确

#### F2. 大量反应
- [ ] 评论有 20+ 个反应
- [ ] 查看反应显示
- [ ] **预期结果**：
  - 反应正确显示
  - 计数准确

#### F3. 大量通知
- [ ] 用户有 50+ 条通知
- [ ] 打开通知面板
- [ ] **预期结果**：
  - 加载时间 < 2 秒
  - 滚动流畅

---

### G. 错误处理

#### G1. 网络错误
- [ ] 断开网络
- [ ] 尝试添加反应
- [ ] **预期结果**：显示错误提示

#### G2. 权限错误
- [ ] 尝试访问无权限的评论
- [ ] **预期结果**：显示权限错误

#### G3. 无效数据
- [ ] 尝试对不存在的评论添加反应
- [ ] **预期结果**：显示错误提示

---

### H. 国际化测试

#### H1. 中文界面
- [ ] 切换语言到中文
- [ ] 查看所有新功能
- [ ] **预期结果**：
  - 所有文本正确翻译
  - 无英文残留

#### H2. 英文界面
- [ ] 切换语言到英文
- [ ] 查看所有新功能
- [ ] **预期结果**：所有文本显示英文

---

### I. 浏览器兼容性

#### I1. Chrome
- [ ] 在 Chrome 中测试所有功能
- [ ] **预期结果**：所有功能正常

#### I2. Firefox
- [ ] 在 Firefox 中测试所有功能
- [ ] **预期结果**：所有功能正常

#### I3. Safari
- [ ] 在 Safari 中测试所有功能
- [ ] **预期结果**：所有功能正常

---

## 📊 测试结果记录

### 测试环境
- 日期：__________
- 测试人员：__________
- 浏览器：__________
- 操作系统：__________

### 测试统计
- 总测试项：70+
- 通过：__________
- 失败：__________
- 跳过：__________

### 发现的问题
1. ___________________________
2. ___________________________
3. ___________________________

### 测试结论
- [ ] ✅ 所有功能正常，可以发布
- [ ] ⚠️ 有小问题，需要修复
- [ ] ❌ 有严重问题，需要重新测试

---

## 🔧 故障排除

### 问题：通知不显示
**解决方案**：
1. 检查数据库迁移是否成功
2. 检查浏览器控制台错误
3. 检查后端日志

### 问题：反应不保存
**解决方案**：
1. 检查数据库连接
2. 检查唯一约束是否正确
3. 检查用户权限

### 问题：搜索无结果
**解决方案**：
1. 检查搜索参数
2. 检查数据库索引
3. 检查 SQL 查询

---

## 📝 测试完成签名

测试人员：____________  
日期：____________  
签名：____________

# å®å¡”é¢æ¿éƒ¨ç½² NoteDoc å®Œæ•´æŒ‡å—

> æœ¬æŒ‡å—æä¾›åœ¨å®å¡”é¢æ¿ç¯å¢ƒä¸‹ä½¿ç”¨ Docker éƒ¨ç½² NoteDoc çš„è¯¦ç»†æ­¥éª¤ï¼ŒåŒ…å«å›¾æ–‡è¯´æ˜å’Œå¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ5 åˆ†é’Ÿéƒ¨ç½²ï¼‰

å¦‚æœä½ çš„å®å¡” Docker ç®¡ç†å™¨ç•Œé¢ä¸­**æ²¡æœ‰ "Compose" é€‰é¡¹**ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

```bash
# 1. æ‰“å¼€å®å¡”ç»ˆç«¯ï¼ˆæˆ– SSH è¿æ¥æœåŠ¡å™¨ï¼‰

# 2. åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p /www/wwwroot/notedoc
cd /www/wwwroot/notedoc

# 3. ä¸‹è½½é…ç½®æ–‡ä»¶
curl -O https://raw.githubusercontent.com/onlinedear/wiki/main/docker-compose.yml

# 4. ç”Ÿæˆå®‰å…¨å¯†é’¥
openssl rand -hex 32  # å¤åˆ¶è¾“å‡ºï¼Œç”¨äº APP_SECRET
openssl rand -base64 24 | tr -d "=+/" | cut -c1-24  # ç”¨äºæ•°æ®åº“å¯†ç 

# 5. ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼ˆä½¿ç”¨ nano æˆ– viï¼‰
nano docker-compose.yml
# ä¿®æ”¹ APP_SECRETã€æ•°æ®åº“å¯†ç ã€APP_URL

# 6. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 7. æŸ¥çœ‹çŠ¶æ€
docker-compose ps
```

å®Œæˆåè®¿é—®ï¼š`http://æœåŠ¡å™¨IP:3000`

è¯¦ç»†æ­¥éª¤è¯·ç»§ç»­é˜…è¯»ä¸‹æ–‡ ğŸ‘‡

## ğŸ“‹ å‰ç½®è¦æ±‚

### æœåŠ¡å™¨è¦æ±‚

**æœ€ä½é…ç½®**ï¼š
- CPU: 2æ ¸
- å†…å­˜: 4GB
- ç¡¬ç›˜: 20GB SSD
- å¸¦å®½: 5Mbps

**æ¨èé…ç½®**ï¼š
- CPU: 4æ ¸
- å†…å­˜: 8GB
- ç¡¬ç›˜: 50GB SSD
- å¸¦å®½: 10Mbps

### è½¯ä»¶è¦æ±‚

- å®å¡”é¢æ¿ Linux ç‰ˆæœ¬ 7.x æˆ–æ›´é«˜
- æ“ä½œç³»ç»Ÿï¼šUbuntu 20.04+ / CentOS 7+ / Debian 10+
- åŸŸåï¼ˆå¯é€‰ï¼Œç”Ÿäº§ç¯å¢ƒå¼ºçƒˆæ¨èï¼‰

> ğŸ“Œ **å…³äºå®å¡” Docker ç®¡ç†å™¨ç‰ˆæœ¬**ï¼š
> - å®å¡” Docker ç®¡ç†å™¨æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç•Œé¢å¯èƒ½ä¸åŒ
> - éƒ¨åˆ†ç‰ˆæœ¬ä¸æ”¯æŒé€šè¿‡ç•Œé¢åˆ›å»º Compose é¡¹ç›®
> - **æœ¬æŒ‡å—ä¸»è¦ä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼**ï¼Œé€‚ç”¨äºæ‰€æœ‰ç‰ˆæœ¬
> - å¦‚æœä½ çš„ç•Œé¢ä¸æ–‡æ¡£æˆªå›¾ä¸åŒï¼Œè¯·ä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼ï¼ˆæ›´å¯é ï¼‰

### å‡†å¤‡å·¥ä½œ

- [ ] æœåŠ¡å™¨å·²å®‰è£…å®å¡”é¢æ¿
- [ ] åŸŸåå·²è§£æåˆ°æœåŠ¡å™¨ IPï¼ˆå¦‚ä½¿ç”¨åŸŸåï¼‰
- [ ] æœåŠ¡å™¨é˜²ç«å¢™å·²å¼€æ”¾ 80ã€443 ç«¯å£
- [ ] å‡†å¤‡å¥½é‚®ç®±ç”¨äºç®¡ç†å‘˜è´¦å·

## ä¸€ã€å®‰è£… Docker ç¯å¢ƒ

### 1.1 å®‰è£… Docker ç®¡ç†å™¨

**æ­¥éª¤ 1ï¼šè¿›å…¥è½¯ä»¶å•†åº—**

1. ç™»å½•å®å¡”é¢æ¿ï¼ˆé»˜è®¤åœ°å€ï¼š`http://æœåŠ¡å™¨IP:8888`ï¼‰
2. ç‚¹å‡»å·¦ä¾§èœå• **è½¯ä»¶å•†åº—**
3. åœ¨æœç´¢æ¡†è¾“å…¥ **Docker ç®¡ç†å™¨**

**æ­¥éª¤ 2ï¼šå®‰è£… Docker**

1. æ‰¾åˆ° **Docker ç®¡ç†å™¨** æ’ä»¶
2. ç‚¹å‡»å³ä¾§ **å®‰è£…** æŒ‰é’®
3. ç­‰å¾…å®‰è£…å®Œæˆï¼ˆçº¦ 2-5 åˆ†é’Ÿï¼‰

> ğŸ’¡ **æç¤º**ï¼šå¦‚æœå®‰è£…å¤±è´¥ï¼Œå¯ä»¥å°è¯•é€šè¿‡ SSH æ‰‹åŠ¨å®‰è£…ï¼š
> ```bash
> curl -fsSL https://get.docker.com | bash
> systemctl start docker
> systemctl enable docker
> ```

### 1.2 éªŒè¯ Docker å®‰è£…

**æ–¹æ³• 1ï¼šé€šè¿‡å®å¡”é¢æ¿**

å®‰è£…å®Œæˆåï¼Œåœ¨å®å¡”é¢æ¿å·¦ä¾§èœå•ä¼šå‡ºç° **Docker** é€‰é¡¹ï¼Œç‚¹å‡»å¯ä»¥çœ‹åˆ° Docker ç®¡ç†ç•Œé¢ã€‚

**æ–¹æ³• 2ï¼šé€šè¿‡ SSH ç»ˆç«¯**

```bash
# æ£€æŸ¥ Docker ç‰ˆæœ¬
docker --version
# è¾“å‡ºç¤ºä¾‹ï¼šDocker version 24.0.7, build afdd53b

# æ£€æŸ¥ Docker Compose ç‰ˆæœ¬
docker-compose --version
# è¾“å‡ºç¤ºä¾‹ï¼šDocker Compose version v2.23.0

# æ£€æŸ¥ Docker æœåŠ¡çŠ¶æ€
systemctl status docker
```

å¦‚æœçœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯´æ˜ Docker å®‰è£…æˆåŠŸã€‚

## äºŒã€å‡†å¤‡éƒ¨ç½²æ–‡ä»¶

### 2.1 åˆ›å»ºé¡¹ç›®ç›®å½•

**æ–¹æ³• 1ï¼šé€šè¿‡å®å¡”æ–‡ä»¶ç®¡ç†å™¨ï¼ˆæ¨èï¼‰**

1. ç‚¹å‡»å®å¡”é¢æ¿å·¦ä¾§ **æ–‡ä»¶** èœå•
2. è¿›å…¥ `/www/wwwroot` ç›®å½•
3. ç‚¹å‡» **æ–°å»ºç›®å½•**ï¼Œè¾“å…¥ `notedoc`
4. è¿›å…¥ `notedoc` ç›®å½•

**æ–¹æ³• 2ï¼šé€šè¿‡ SSH ç»ˆç«¯**

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p /www/wwwroot/notedoc
cd /www/wwwroot/notedoc

# è®¾ç½®ç›®å½•æƒé™
chmod 755 /www/wwwroot/notedoc
```

### 2.2 ç”Ÿæˆå®‰å…¨å¯†é’¥

åœ¨åˆ›å»ºé…ç½®æ–‡ä»¶ä¹‹å‰ï¼Œå…ˆç”Ÿæˆå®‰å…¨å¯†é’¥ã€‚

**é€šè¿‡ SSH ç»ˆç«¯ç”Ÿæˆ**ï¼š

```bash
# ç”Ÿæˆ APP_SECRETï¼ˆ32å­—èŠ‚åå…­è¿›åˆ¶ï¼Œ64å­—ç¬¦ï¼‰
openssl rand -hex 32

# ç¤ºä¾‹è¾“å‡ºï¼š
# 0a1b2c3d4e5f6789abcdef0123456789fedcba9876543210abcdef0123456789

# ç”Ÿæˆæ•°æ®åº“å¯†ç ï¼ˆ24å­—ç¬¦ï¼‰
openssl rand -base64 24 | tr -d "=+/" | cut -c1-24

# ç¤ºä¾‹è¾“å‡ºï¼š
# Xy9Kp2Lm4Nq8Rs6Tv1Wz3Bc5
```

> ğŸ’¡ **é‡è¦**ï¼šè¯·å¦¥å–„ä¿å­˜è¿™äº›å¯†é’¥ï¼Œåç»­æ— æ³•æ‰¾å›ï¼

**å¦‚æœæ²¡æœ‰ SSH è®¿é—®æƒé™**ï¼Œå¯ä»¥ä½¿ç”¨åœ¨çº¿å·¥å…·ç”Ÿæˆï¼š
- APP_SECRET: è®¿é—® https://www.random.org/strings/ ç”Ÿæˆ 64 ä½éšæœºå­—ç¬¦ä¸²
- æ•°æ®åº“å¯†ç : ç”Ÿæˆ 24 ä½éšæœºå­—ç¬¦ä¸²

### 2.3 åˆ›å»º docker-compose.yml

**æ–¹æ³• 1ï¼šé€šè¿‡å®å¡”æ–‡ä»¶ç®¡ç†å™¨**

1. åœ¨ `/www/wwwroot/notedoc` ç›®å½•ä¸‹
2. ç‚¹å‡» **æ–°å»ºæ–‡ä»¶**
3. æ–‡ä»¶åè¾“å…¥ï¼š`docker-compose.yml`
4. ç‚¹å‡» **ç¼–è¾‘**ï¼Œç²˜è´´ä»¥ä¸‹å†…å®¹ï¼š

```yaml
services:
  notedoc:
    image: notedoc/notedoc:latest
    container_name: notedoc
    depends_on:
      - db
      - redis
    environment:
      # åº”ç”¨è®¿é—®åœ°å€ï¼ˆæ”¹ä¸ºä½ çš„åŸŸåæˆ– IPï¼‰
      APP_URL: 'http://your-server-ip:3000'
      
      # åº”ç”¨å¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ï¼ä½¿ç”¨ä¸Šé¢ç”Ÿæˆçš„ APP_SECRETï¼‰
      APP_SECRET: '0a1b2c3d4e5f6789abcdef0123456789fedcba9876543210abcdef0123456789'
      
      # JWT ä»¤ç‰Œè¿‡æœŸæ—¶é—´
      JWT_TOKEN_EXPIRES_IN: '30d'
      
      # æ•°æ®åº“è¿æ¥ï¼ˆå¯†ç æ”¹ä¸ºä¸Šé¢ç”Ÿæˆçš„æ•°æ®åº“å¯†ç ï¼‰
      DATABASE_URL: 'postgresql://notedoc:Xy9Kp2Lm4Nq8Rs6Tv1Wz3Bc5@db:5432/notedoc?schema=public'
      
      # Redis è¿æ¥
      REDIS_URL: 'redis://redis:6379'
      
      # å­˜å‚¨é©±åŠ¨ï¼ˆlocal æˆ– s3ï¼‰
      STORAGE_DRIVER: 'local'
      
      # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
      FILE_UPLOAD_SIZE_LIMIT: '50mb'
      
      # ç¦ç”¨é¥æµ‹ï¼ˆå¯é€‰ï¼‰
      DISABLE_TELEMETRY: 'true'
      
      # é‚®ä»¶é…ç½®ï¼ˆå¯é€‰ï¼Œåç»­å¯é…ç½®ï¼‰
      # MAIL_DRIVER: 'smtp'
      # MAIL_FROM_ADDRESS: 'noreply@your-domain.com'
      # MAIL_FROM_NAME: 'NoteDoc'
      # SMTP_HOST: 'smtp.gmail.com'
      # SMTP_PORT: '587'
      # SMTP_USERNAME: 'your-email@gmail.com'
      # SMTP_PASSWORD: 'your-app-password'
      # SMTP_SECURE: 'false'
      
    ports:
      - "3000:3000"
    restart: unless-stopped
    volumes:
      - notedoc_data:/app/data/storage
    networks:
      - notedoc_network

  db:
    image: postgres:16-alpine
    container_name: notedoc_db
    environment:
      POSTGRES_DB: notedoc
      POSTGRES_USER: notedoc
      # æ•°æ®åº“å¯†ç ï¼ˆå¿…é¡»ä¸ä¸Šé¢ DATABASE_URL ä¸­çš„å¯†ç ä¸€è‡´ï¼‰
      POSTGRES_PASSWORD: 'Xy9Kp2Lm4Nq8Rs6Tv1Wz3Bc5'
    restart: unless-stopped
    volumes:
      - db_data:/var/lib/postgresql/data
    networks:
      - notedoc_network
    # å¯é€‰ï¼šå¦‚æœéœ€è¦å¤–éƒ¨è®¿é—®æ•°æ®åº“ï¼ˆä¸æ¨èï¼‰
    # ports:
    #   - "5432:5432"

  redis:
    image: redis:7.2-alpine
    container_name: notedoc_redis
    restart: unless-stopped
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes
    networks:
      - notedoc_network

volumes:
  notedoc_data:
  db_data:
  redis_data:

networks:
  notedoc_network:
    driver: bridge
```

5. **é‡è¦**ï¼šä¿®æ”¹ä»¥ä¸‹é…ç½®é¡¹ï¼š
   - `APP_SECRET`: æ›¿æ¢ä¸ºä½ ç”Ÿæˆçš„ 64 å­—ç¬¦å¯†é’¥
   - `DATABASE_URL` ä¸­çš„å¯†ç : æ›¿æ¢ä¸ºä½ ç”Ÿæˆçš„æ•°æ®åº“å¯†ç 
   - `POSTGRES_PASSWORD`: æ›¿æ¢ä¸ºç›¸åŒçš„æ•°æ®åº“å¯†ç 
   - `APP_URL`: 
     - å¦‚æœä½¿ç”¨åŸŸåï¼š`https://doc.example.com`
     - å¦‚æœä½¿ç”¨ IPï¼š`http://your-server-ip:3000`

6. ç‚¹å‡» **ä¿å­˜**

**æ–¹æ³• 2ï¼šé€šè¿‡ SSH ç»ˆç«¯**

```bash
cd /www/wwwroot/notedoc

# ä¸‹è½½ç¤ºä¾‹é…ç½®æ–‡ä»¶
curl -O https://raw.githubusercontent.com/onlinedear/wiki/main/docker-compose.yml

# æˆ–æ‰‹åŠ¨åˆ›å»º
nano docker-compose.yml
# ç²˜è´´ä¸Šé¢çš„å†…å®¹ï¼Œä¿®æ”¹é…ç½®ï¼Œä¿å­˜é€€å‡ºï¼ˆCtrl+X, Y, Enterï¼‰
```

### 2.4 é…ç½®æ£€æŸ¥æ¸…å•

åœ¨å¯åŠ¨ä¹‹å‰ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹é…ç½®å·²æ­£ç¡®ä¿®æ”¹ï¼š

- [ ] `APP_SECRET` å·²æ›¿æ¢ä¸º 64 å­—ç¬¦éšæœºå¯†é’¥
- [ ] `DATABASE_URL` ä¸­çš„å¯†ç å·²ä¿®æ”¹
- [ ] `POSTGRES_PASSWORD` å·²ä¿®æ”¹ä¸”ä¸ `DATABASE_URL` ä¸­çš„å¯†ç ä¸€è‡´
- [ ] `APP_URL` å·²è®¾ç½®ä¸ºä½ çš„åŸŸåæˆ–æœåŠ¡å™¨ IP
- [ ] æ–‡ä»¶å·²ä¿å­˜

## ä¸‰ã€å¯åŠ¨æœåŠ¡

> ğŸ’¡ **é‡è¦æç¤º**ï¼šå®å¡” Docker ç®¡ç†å™¨æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç•Œé¢å¯èƒ½ä¸åŒã€‚å¦‚æœä½ çš„ç•Œé¢ä¸­æ²¡æœ‰ "Compose" é€‰é¡¹ï¼Œè¯·ç›´æ¥ä½¿ç”¨ **3.2 å‘½ä»¤è¡Œæ–¹å¼**ï¼ˆæ¨èï¼‰ã€‚

### 3.1 å®å¡” Docker ç®¡ç†å™¨å¯åŠ¨ï¼ˆç•Œé¢æ–¹å¼ï¼‰

**æ­¥éª¤ 1ï¼šè¿›å…¥ Docker ç®¡ç†**

1. ç‚¹å‡»å®å¡”é¢æ¿å·¦ä¾§ **Docker** èœå•
2. ç‚¹å‡»é¡¶éƒ¨ **ç®¡ç†** æ ‡ç­¾ï¼ˆæˆ– **å®¹å™¨** æ ‡ç­¾ï¼‰

**æ­¥éª¤ 2ï¼šåˆ›å»ºå®¹å™¨**

æ ¹æ®ä½ çš„å®å¡” Docker ç®¡ç†å™¨ç‰ˆæœ¬ï¼Œç•Œé¢å¯èƒ½ä¸åŒï¼š

**æ–¹å¼ Aï¼šæ–°ç‰ˆç•Œé¢ï¼ˆæœ‰"åˆ›å»ºå®¹å™¨"æŒ‰é’®ï¼‰**

1. ç‚¹å‡» **åˆ›å»ºå®¹å™¨** æŒ‰é’®
2. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼š
   - **æ‰‹åŠ¨åˆ›å»º** æ ‡ç­¾ï¼šé€‰æ‹© **æ‰‹åŠ¨åˆ›å»º**
   - **å®¹å™¨åç§°**ï¼šè¾“å…¥ `notedoc`
   - **é•œåƒ**ï¼šè¾“å…¥ `notedoc/notedoc:latest`
   - å…¶ä»–é…ç½®æš‚æ—¶è·³è¿‡
3. ç‚¹å‡» **åˆ›å»º** æŒ‰é’®

> âš ï¸ **æ³¨æ„**ï¼šæ–°ç‰ˆå®å¡” Docker ç®¡ç†å™¨å¯èƒ½ä¸æ”¯æŒç›´æ¥é€šè¿‡ç•Œé¢åˆ›å»º Compose é¡¹ç›®ï¼Œå»ºè®®ä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼ï¼ˆè§ 3.2 èŠ‚ï¼‰ã€‚

**æ–¹å¼ Bï¼šæ—§ç‰ˆç•Œé¢ï¼ˆæœ‰"æ·»åŠ å®¹å™¨"å’Œ"Compose"é€‰é¡¹ï¼‰**

1. ç‚¹å‡»å³ä¸Šè§’ **æ·»åŠ å®¹å™¨** æŒ‰é’®
2. é€‰æ‹© **Compose** æ–¹å¼
3. å¡«å†™é…ç½®ï¼š
   - **é¡¹ç›®åç§°**ï¼š`notedoc`
   - **é¡¹ç›®è·¯å¾„**ï¼šç‚¹å‡»é€‰æ‹©ï¼Œå¯¼èˆªåˆ° `/www/wwwroot/notedoc`
   - **Compose æ–‡ä»¶**ï¼šä¼šè‡ªåŠ¨è¯†åˆ« `docker-compose.yml`
4. ç‚¹å‡» **ç¡®å®š** å¼€å§‹éƒ¨ç½²

**æ­¥éª¤ 3ï¼šå¦‚æœç•Œé¢ä¸æ”¯æŒ Compose**

å¦‚æœä½ çš„å®å¡” Docker ç®¡ç†å™¨ç•Œé¢ä¸­ï¼š
- âŒ æ²¡æœ‰ "Compose" é€‰é¡¹
- âŒ æ²¡æœ‰ "é¡¹ç›®è·¯å¾„" è¾“å…¥æ¡†
- âŒ åªèƒ½åˆ›å»ºå•ä¸ªå®¹å™¨

**è¯·ç›´æ¥è·³åˆ° 3.2 èŠ‚ä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼**ï¼Œè¿™æ˜¯æœ€å¯é çš„æ–¹æ³•ã€‚

> ğŸ“ **è¯´æ˜**ï¼šå®å¡” Docker ç®¡ç†å™¨çš„ä¸åŒç‰ˆæœ¬ç•Œé¢å·®å¼‚å¾ˆå¤§ï¼Œå‘½ä»¤è¡Œæ–¹å¼é€‚ç”¨äºæ‰€æœ‰ç‰ˆæœ¬ã€‚

### 3.2 ä½¿ç”¨å‘½ä»¤è¡Œå¯åŠ¨ï¼ˆæ¨èæ–¹å¼ï¼‰â­

ç”±äºå®å¡” Docker ç®¡ç†å™¨ç‰ˆæœ¬å·®å¼‚ï¼Œ**æ¨èä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼å¯åŠ¨**ï¼Œæ›´ç¨³å®šå¯é ã€‚

> âœ… **é€‚ç”¨åœºæ™¯**ï¼š
> - å®å¡”ç•Œé¢ä¸­æ²¡æœ‰ "Compose" é€‰é¡¹
> - åªçœ‹åˆ° "åˆ›å»ºå®¹å™¨" æŒ‰é’®ï¼Œæ²¡æœ‰ "æ·»åŠ å®¹å™¨"
> - æƒ³è¦æ›´å¯é çš„éƒ¨ç½²æ–¹å¼

**æ­¥éª¤ 1ï¼šæ‰“å¼€ç»ˆç«¯**

**æ–¹å¼ Aï¼šä½¿ç”¨å®å¡”é¢æ¿ç»ˆç«¯ï¼ˆæ¨èï¼‰**
1. åœ¨å®å¡”é¢æ¿å³ä¸Šè§’æ‰¾åˆ° **ç»ˆç«¯** å›¾æ ‡ï¼ˆæˆ–åœ¨å·¦ä¾§èœå•æ‰¾åˆ° **ç»ˆç«¯**ï¼‰
2. ç‚¹å‡»æ‰“å¼€ç»ˆç«¯çª—å£

**æ–¹å¼ Bï¼šä½¿ç”¨ SSH å®¢æˆ·ç«¯**
1. ä½¿ç”¨ Xshellã€PuTTYã€æˆ– macOS/Linux ç»ˆç«¯
2. è¿æ¥åˆ°æœåŠ¡å™¨ï¼š`ssh root@your-server-ip`

**æ­¥éª¤ 2ï¼šæ‰§è¡Œå¯åŠ¨å‘½ä»¤**

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/notedoc

# æ‹‰å–é•œåƒï¼ˆé¦–æ¬¡éƒ¨ç½²ï¼Œéœ€è¦ç­‰å¾…å‡ åˆ†é’Ÿï¼‰
docker-compose pull

# è¾“å‡ºç¤ºä¾‹ï¼š
# [+] Pulling 3/3
#  âœ” notedoc Pulling
#  âœ” db Pulling
#  âœ” redis Pulling

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# è¾“å‡ºç¤ºä¾‹ï¼š
# [+] Running 4/4
#  âœ” Network notedoc_notedoc_network  Created
#  âœ” Container notedoc_redis          Started
#  âœ” Container notedoc_db             Started
#  âœ” Container notedoc                Started
```

**æ­¥éª¤ 3ï¼šç­‰å¾…æœåŠ¡å¯åŠ¨**

é¦–æ¬¡å¯åŠ¨éœ€è¦ï¼š
- ä¸‹è½½ Docker é•œåƒï¼ˆçº¦ 500MB-1GBï¼‰
- åˆå§‹åŒ–æ•°æ®åº“
- å¯åŠ¨æ‰€æœ‰æœåŠ¡

é€šå¸¸éœ€è¦ 3-10 åˆ†é’Ÿï¼Œå–å†³äºç½‘ç»œé€Ÿåº¦ã€‚

> ğŸ’¡ **æç¤º**ï¼šå¦‚æœé•œåƒä¸‹è½½å¾ˆæ…¢ï¼Œå¯ä»¥é…ç½® Docker é•œåƒåŠ é€Ÿï¼ˆè§ä¸‹æ–¹"å¸¸è§å¯åŠ¨é—®é¢˜"ï¼‰ã€‚

### 3.3 éªŒè¯æœåŠ¡çŠ¶æ€

**æ–¹æ³• 1ï¼šé€šè¿‡å®å¡” Docker ç®¡ç†å™¨**

1. åœ¨ **Docker** > **å®¹å™¨** ä¸­æŸ¥çœ‹
2. ç¡®è®¤ä¸‰ä¸ªå®¹å™¨éƒ½æ˜¾ç¤º **è¿è¡Œä¸­**ï¼š
   - `notedoc` - ä¸»åº”ç”¨
   - `notedoc_db` - PostgreSQL æ•°æ®åº“
   - `notedoc_redis` - Redis ç¼“å­˜

**æ–¹æ³• 2ï¼šé€šè¿‡å‘½ä»¤è¡Œ**

```bash
cd /www/wwwroot/notedoc

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# è¾“å‡ºç¤ºä¾‹ï¼š
# NAME              IMAGE                    STATUS
# notedoc           notedoc/notedoc:latest   Up 2 minutes
# notedoc_db        postgres:16-alpine       Up 2 minutes
# notedoc_redis     redis:7.2-alpine         Up 2 minutes

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs -f notedoc

# çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—è¯´æ˜å¯åŠ¨æˆåŠŸï¼š
# [NestApplication] Nest application successfully started
# [NestApplication] Listening on http://127.0.0.1:3000
```

**æ–¹æ³• 3ï¼šå¥åº·æ£€æŸ¥**

```bash
# æ£€æŸ¥åº”ç”¨å¥åº·çŠ¶æ€
curl http://localhost:3000/api/health

# æ­£å¸¸è¾“å‡ºï¼š
# {"status":"ok","info":{"database":{"status":"up"},"redis":{"status":"up"}}}
```

### 3.4 å¸¸è§å¯åŠ¨é—®é¢˜

**é—®é¢˜ 1ï¼šç«¯å£è¢«å ç”¨**

```bash
# é”™è¯¯ä¿¡æ¯ï¼šBind for 0.0.0.0:3000 failed: port is already allocated

# è§£å†³æ–¹æ¡ˆï¼šä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„
ports:
  - "3001:3000"  # æ”¹ä¸ºå…¶ä»–ç«¯å£
```

**é—®é¢˜ 2ï¼šé•œåƒä¸‹è½½å¤±è´¥**

```bash
# é”™è¯¯ä¿¡æ¯ï¼šError response from daemon: Get https://registry-1.docker.io/...

# è§£å†³æ–¹æ¡ˆï¼šé…ç½® Docker é•œåƒåŠ é€Ÿ
# åœ¨å®å¡”é¢æ¿ Docker è®¾ç½®ä¸­æ·»åŠ é•œåƒæºï¼Œæˆ–é€šè¿‡å‘½ä»¤ï¼š
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com"
  ]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
```

**é—®é¢˜ 3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥**

```bash
# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs db

# ç¡®ä¿ DATABASE_URL ä¸­çš„å¯†ç ä¸ POSTGRES_PASSWORD ä¸€è‡´
```

## å››ã€é…ç½®åå‘ä»£ç†å’ŒåŸŸåï¼ˆæ¨èï¼‰

> ğŸ’¡ **è¯´æ˜**ï¼šå¦‚æœåªæ˜¯æµ‹è¯•ï¼Œå¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ï¼Œç›´æ¥é€šè¿‡ `http://æœåŠ¡å™¨IP:3000` è®¿é—®ã€‚ç”Ÿäº§ç¯å¢ƒå¼ºçƒˆå»ºè®®é…ç½®åŸŸåå’Œ HTTPSã€‚

### 4.1 æ·»åŠ ç½‘ç«™

**æ­¥éª¤ 1ï¼šåˆ›å»ºç«™ç‚¹**

1. åœ¨å®å¡”é¢æ¿ç‚¹å‡»å·¦ä¾§ **ç½‘ç«™** èœå•
2. ç‚¹å‡» **æ·»åŠ ç«™ç‚¹** æŒ‰é’®
3. å¡«å†™ç«™ç‚¹ä¿¡æ¯ï¼š
   - **åŸŸå**ï¼šè¾“å…¥ä½ çš„åŸŸåï¼ˆå¦‚ `doc.example.com`ï¼‰
   - **å¤‡æ³¨**ï¼š`NoteDoc æ–‡æ¡£å¹³å°`
   - **æ ¹ç›®å½•**ï¼šä¿æŒé»˜è®¤æˆ–é€‰æ‹© `/www/wwwroot/notedoc`
   - **FTP**ï¼šä¸åˆ›å»º
   - **æ•°æ®åº“**ï¼šä¸åˆ›å»ºï¼ˆå·²é€šè¿‡ Docker åˆ›å»ºï¼‰
   - **PHP ç‰ˆæœ¬**ï¼šçº¯é™æ€
4. ç‚¹å‡» **æäº¤**

**æ­¥éª¤ 2ï¼šç¡®è®¤åŸŸåè§£æ**

åœ¨æ·»åŠ ç«™ç‚¹å‰ï¼Œç¡®ä¿åŸŸåå·²æ­£ç¡®è§£æåˆ°æœåŠ¡å™¨ IPï¼š

```bash
# æ£€æŸ¥åŸŸåè§£æ
ping doc.example.com

# æˆ–ä½¿ç”¨ nslookup
nslookup doc.example.com
```

### 4.2 é…ç½®åå‘ä»£ç†

**æ­¥éª¤ 1ï¼šè¿›å…¥ç«™ç‚¹è®¾ç½®**

1. åœ¨ç½‘ç«™åˆ—è¡¨ä¸­æ‰¾åˆ°åˆšåˆ›å»ºçš„ç«™ç‚¹
2. ç‚¹å‡»å³ä¾§ **è®¾ç½®** æŒ‰é’®

**æ­¥éª¤ 2ï¼šæ·»åŠ åå‘ä»£ç†**

1. ç‚¹å‡»å·¦ä¾§ **åå‘ä»£ç†** é€‰é¡¹
2. ç‚¹å‡» **æ·»åŠ åå‘ä»£ç†** æŒ‰é’®
3. å¡«å†™ä»£ç†é…ç½®ï¼š
   - **ä»£ç†åç§°**ï¼š`notedoc`
   - **ç›®æ ‡ URL**ï¼š`http://127.0.0.1:3000`
   - **å‘é€åŸŸå**ï¼š`$host`
   - **å†…å®¹æ›¿æ¢**ï¼šç•™ç©º
4. ç‚¹å‡» **æäº¤**

**æ­¥éª¤ 3ï¼šä¼˜åŒ–ä»£ç†é…ç½®ï¼ˆå¯é€‰ï¼‰**

ç‚¹å‡»åˆšåˆ›å»ºçš„åå‘ä»£ç†å³ä¾§çš„ **é…ç½®æ–‡ä»¶**ï¼Œæ·»åŠ ä»¥ä¸‹é…ç½®ä»¥æ”¯æŒ WebSocket å’Œå¤§æ–‡ä»¶ä¸Šä¼ ï¼š

```nginx
location / {
    proxy_pass http://127.0.0.1:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header REMOTE-HOST $remote_addr;
    
    # WebSocket æ”¯æŒ
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    
    # è¶…æ—¶è®¾ç½®
    proxy_connect_timeout 300s;
    proxy_send_timeout 300s;
    proxy_read_timeout 300s;
    
    # ç¼“å†²è®¾ç½®
    proxy_buffering off;
    proxy_cache_bypass $http_upgrade;
    
    # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
    client_max_body_size 50m;
}
```

ä¿å­˜åé‡å¯ Nginxï¼š
```bash
nginx -t && nginx -s reload
```

### 4.3 é…ç½® SSL è¯ä¹¦ï¼ˆå¼ºçƒˆæ¨èï¼‰

**æ­¥éª¤ 1ï¼šç”³è¯· Let's Encrypt å…è´¹è¯ä¹¦**

1. åœ¨ç½‘ç«™è®¾ç½®ä¸­ç‚¹å‡»å·¦ä¾§ **SSL** é€‰é¡¹
2. é€‰æ‹© **Let's Encrypt** æ ‡ç­¾
3. å¡«å†™é…ç½®ï¼š
   - **åŸŸå**ï¼šå‹¾é€‰ä½ çš„åŸŸåï¼ˆå¦‚ `doc.example.com`ï¼‰
   - **é‚®ç®±**ï¼šå¡«å†™ä½ çš„é‚®ç®±ï¼ˆç”¨äºè¯ä¹¦åˆ°æœŸæé†’ï¼‰
   - **éªŒè¯æ–¹å¼**ï¼šé€‰æ‹© **æ–‡ä»¶éªŒè¯**ï¼ˆæ¨èï¼‰
4. ç‚¹å‡» **ç”³è¯·** æŒ‰é’®
5. ç­‰å¾…ç”³è¯·å®Œæˆï¼ˆé€šå¸¸ 1-2 åˆ†é’Ÿï¼‰

**æ­¥éª¤ 2ï¼šå¯ç”¨ HTTPS**

è¯ä¹¦ç”³è¯·æˆåŠŸåï¼š
1. åœ¨ SSL é¡µé¢ï¼Œå¼€å¯ **å¼ºåˆ¶ HTTPS** å¼€å…³
2. å¼€å¯ **HSTS** å¼€å…³ï¼ˆå¯é€‰ï¼Œå¢å¼ºå®‰å…¨æ€§ï¼‰
3. ç‚¹å‡» **ä¿å­˜**

**æ­¥éª¤ 3ï¼šéªŒè¯ SSL é…ç½®**

```bash
# æµ‹è¯• HTTPS è®¿é—®
curl -I https://doc.example.com

# åº”è¯¥çœ‹åˆ°ï¼š
# HTTP/2 200
# ...
```

### 4.4 æ›´æ–°åº”ç”¨é…ç½®

SSL é…ç½®å®Œæˆåï¼Œéœ€è¦æ›´æ–° `docker-compose.yml` ä¸­çš„ `APP_URL`ï¼š

**æ–¹æ³• 1ï¼šé€šè¿‡å®å¡”æ–‡ä»¶ç®¡ç†å™¨**

1. è¿›å…¥ `/www/wwwroot/notedoc` ç›®å½•
2. ç¼–è¾‘ `docker-compose.yml` æ–‡ä»¶
3. ä¿®æ”¹ `APP_URL`ï¼š
   ```yaml
   APP_URL: 'https://doc.example.com'  # æ”¹ä¸º https å’Œä½ çš„åŸŸå
   ```
4. ä¿å­˜æ–‡ä»¶

**æ–¹æ³• 2ï¼šé€šè¿‡ SSH ç»ˆç«¯**

```bash
cd /www/wwwroot/notedoc

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano docker-compose.yml

# ä¿®æ”¹ APP_URL è¡Œï¼Œä¿å­˜é€€å‡ºï¼ˆCtrl+X, Y, Enterï¼‰
```

**é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ**ï¼š

```bash
cd /www/wwwroot/notedoc

# åœæ­¢æœåŠ¡
docker-compose down

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ
docker-compose logs -f notedoc
```

æˆ–é€šè¿‡å®å¡” Docker ç®¡ç†å™¨é‡å¯å®¹å™¨ã€‚

### 4.5 æµ‹è¯•è®¿é—®

**HTTP è®¿é—®ï¼ˆä¼šè‡ªåŠ¨è·³è½¬åˆ° HTTPSï¼‰**ï¼š
```
http://doc.example.com
```

**HTTPS è®¿é—®**ï¼š
```
https://doc.example.com
```

**å¥åº·æ£€æŸ¥**ï¼š
```
https://doc.example.com/api/health
```

å¦‚æœèƒ½æ­£å¸¸è®¿é—®ï¼Œè¯´æ˜åå‘ä»£ç†å’Œ SSL é…ç½®æˆåŠŸï¼

## äº”ã€é…ç½®é˜²ç«å¢™å’Œå®‰å…¨

### 5.1 å®å¡”é¢æ¿é˜²ç«å¢™

**æ­¥éª¤ 1ï¼šè¿›å…¥å®‰å…¨è®¾ç½®**

1. ç‚¹å‡»å®å¡”é¢æ¿å·¦ä¾§ **å®‰å…¨** èœå•
2. æŸ¥çœ‹å½“å‰å¼€æ”¾çš„ç«¯å£

**æ­¥éª¤ 2ï¼šé…ç½®ç«¯å£è§„åˆ™**

æ ¹æ®ä½ çš„éƒ¨ç½²æ–¹å¼é…ç½®ï¼š

**åœºæ™¯ Aï¼šä½¿ç”¨åå‘ä»£ç†ï¼ˆæ¨èï¼‰**
- âœ… å¼€æ”¾ **80** ç«¯å£ï¼ˆHTTPï¼‰
- âœ… å¼€æ”¾ **443** ç«¯å£ï¼ˆHTTPSï¼‰
- âœ… å¼€æ”¾ **8888** ç«¯å£ï¼ˆå®å¡”é¢æ¿ï¼‰
- âŒ **ä¸è¦**å¼€æ”¾ **3000** ç«¯å£ï¼ˆåº”ç”¨ç«¯å£ï¼Œé€šè¿‡åå‘ä»£ç†è®¿é—®ï¼‰

**åœºæ™¯ Bï¼šç›´æ¥è®¿é—®ï¼ˆä»…æµ‹è¯•ï¼‰**
- âœ… å¼€æ”¾ **3000** ç«¯å£ï¼ˆåº”ç”¨ç«¯å£ï¼‰
- âœ… å¼€æ”¾ **8888** ç«¯å£ï¼ˆå®å¡”é¢æ¿ï¼‰

**æ·»åŠ ç«¯å£è§„åˆ™**ï¼š
1. ç‚¹å‡» **æ·»åŠ ç«¯å£è§„åˆ™**
2. å¡«å†™ç«¯å£å·ï¼ˆå¦‚ `80`ï¼‰
3. å¤‡æ³¨å¡«å†™ç”¨é€”ï¼ˆå¦‚ `HTTP`ï¼‰
4. ç‚¹å‡» **ç¡®å®š**

### 5.2 äº‘æœåŠ¡å™¨å®‰å…¨ç»„

å¦‚æœä½¿ç”¨äº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ç­‰ï¼‰ï¼Œè¿˜éœ€è¦åœ¨äº‘æ§åˆ¶å°é…ç½®å®‰å…¨ç»„ï¼š

**é˜¿é‡Œäº‘ ECS**ï¼š
1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
2. è¿›å…¥ **äº‘æœåŠ¡å™¨ ECS** > **å®ä¾‹**
3. ç‚¹å‡»å®ä¾‹ ID è¿›å…¥è¯¦æƒ…
4. ç‚¹å‡» **å®‰å…¨ç»„** æ ‡ç­¾
5. ç‚¹å‡» **é…ç½®è§„åˆ™**
6. æ·»åŠ å…¥æ–¹å‘è§„åˆ™ï¼š
   - ç«¯å£èŒƒå›´ï¼š`80/80`ï¼Œæˆæƒå¯¹è±¡ï¼š`0.0.0.0/0`
   - ç«¯å£èŒƒå›´ï¼š`443/443`ï¼Œæˆæƒå¯¹è±¡ï¼š`0.0.0.0/0`

**è…¾è®¯äº‘ CVM**ï¼š
1. ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
2. è¿›å…¥ **äº‘æœåŠ¡å™¨** > **å®‰å…¨ç»„**
3. æ‰¾åˆ°å®ä¾‹å…³è”çš„å®‰å…¨ç»„ï¼Œç‚¹å‡» **ä¿®æ”¹è§„åˆ™**
4. æ·»åŠ å…¥ç«™è§„åˆ™ï¼š
   - ç±»å‹ï¼š`HTTP(80)`ï¼Œæ¥æºï¼š`0.0.0.0/0`
   - ç±»å‹ï¼š`HTTPS(443)`ï¼Œæ¥æºï¼š`0.0.0.0/0`

**åä¸ºäº‘ ECS**ï¼š
1. ç™»å½•åä¸ºäº‘æ§åˆ¶å°
2. è¿›å…¥ **å¼¹æ€§äº‘æœåŠ¡å™¨** > **å®‰å…¨ç»„**
3. ç‚¹å‡»å®‰å…¨ç»„åç§°è¿›å…¥è¯¦æƒ…
4. ç‚¹å‡» **å…¥æ–¹å‘è§„åˆ™** > **æ·»åŠ è§„åˆ™**
5. æ·»åŠ è§„åˆ™ï¼š
   - åè®®ç«¯å£ï¼š`TCP:80`ï¼Œæºåœ°å€ï¼š`0.0.0.0/0`
   - åè®®ç«¯å£ï¼š`TCP:443`ï¼Œæºåœ°å€ï¼š`0.0.0.0/0`

### 5.3 ç³»ç»Ÿé˜²ç«å¢™ï¼ˆå¯é€‰ï¼‰

å¦‚æœæœåŠ¡å™¨å¯ç”¨äº†ç³»ç»Ÿé˜²ç«å¢™ï¼ˆfirewalld æˆ– ufwï¼‰ï¼Œä¹Ÿéœ€è¦é…ç½®ï¼š

**CentOS/RHEL (firewalld)**ï¼š
```bash
# å¼€æ”¾ HTTP å’Œ HTTPS
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https

# æˆ–æŒ‡å®šç«¯å£
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --permanent --add-port=443/tcp

# é‡è½½é…ç½®
sudo firewall-cmd --reload

# æŸ¥çœ‹è§„åˆ™
sudo firewall-cmd --list-all
```

**Ubuntu/Debian (ufw)**ï¼š
```bash
# å¼€æ”¾ç«¯å£
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

### 5.4 å®‰å…¨åŠ å›ºå»ºè®®

**1. ä¿®æ”¹å®å¡”é¢æ¿é»˜è®¤ç«¯å£**

```bash
# ä¿®æ”¹å®å¡”é¢æ¿ç«¯å£ï¼ˆé»˜è®¤ 8888ï¼‰
# åœ¨å®å¡”é¢æ¿ > é¢æ¿è®¾ç½® > é¢æ¿ç«¯å£
# æ”¹ä¸ºå…¶ä»–ç«¯å£ï¼Œå¦‚ 18888
```

**2. å¯ç”¨å®å¡”é¢æ¿å®‰å…¨å…¥å£**

1. è¿›å…¥ **é¢æ¿è®¾ç½®**
2. å¼€å¯ **å®‰å…¨å…¥å£**
3. è®¾ç½®ä¸€ä¸ªéšæœºè·¯å¾„ï¼ˆå¦‚ `/abc123`ï¼‰
4. è®¿é—®é¢æ¿éœ€è¦ä½¿ç”¨ï¼š`http://IP:8888/abc123`

**3. é…ç½® IP ç™½åå•ï¼ˆå¯é€‰ï¼‰**

å¦‚æœæ˜¯å†…éƒ¨ä½¿ç”¨ï¼Œå¯ä»¥é™åˆ¶è®¿é—® IPï¼š

1. åœ¨å®å¡”é¢æ¿ **å®‰å…¨** ä¸­
2. ç‚¹å‡» **SSH å®‰å…¨**
3. æ·»åŠ å…è®¸çš„ IP åœ°å€

**4. å®šæœŸæ›´æ–°ç³»ç»Ÿ**

```bash
# Ubuntu/Debian
sudo apt update && sudo apt upgrade -y

# CentOS/RHEL
sudo yum update -y
```

## å…­ã€é¦–æ¬¡è®¿é—®å’Œåˆå§‹åŒ–

### 6.1 è®¿é—®åº”ç”¨

æ ¹æ®ä½ çš„é…ç½®æ–¹å¼è®¿é—®ï¼š

**ä½¿ç”¨åŸŸåï¼ˆæ¨èï¼‰**ï¼š
```
https://doc.example.com
```

**ä½¿ç”¨ IP åœ°å€ï¼ˆæµ‹è¯•ï¼‰**ï¼š
```
http://æœåŠ¡å™¨IP:3000
```

### 6.2 æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·

**æ­¥éª¤ 1ï¼šè¿›å…¥æ³¨å†Œé¡µé¢**

é¦–æ¬¡è®¿é—®ä¼šè‡ªåŠ¨è·³è½¬åˆ°æ³¨å†Œé¡µé¢ã€‚

**æ­¥éª¤ 2ï¼šå¡«å†™æ³¨å†Œä¿¡æ¯**

1. **é‚®ç®±åœ°å€**ï¼šè¾“å…¥ç®¡ç†å‘˜é‚®ç®±ï¼ˆç”¨äºç™»å½•ï¼‰
2. **ç”¨æˆ·å**ï¼šè®¾ç½®ç”¨æˆ·å
3. **å¯†ç **ï¼šè®¾ç½®å¼ºå¯†ç ï¼ˆè‡³å°‘ 8 ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—ï¼‰
4. **ç¡®è®¤å¯†ç **ï¼šå†æ¬¡è¾“å…¥å¯†ç 

**æ­¥éª¤ 3ï¼šåˆ›å»ºå·¥ä½œç©ºé—´**

æ³¨å†Œåä¼šæç¤ºåˆ›å»ºå·¥ä½œç©ºé—´ï¼š
1. **å·¥ä½œç©ºé—´åç§°**ï¼šå¦‚ `æˆ‘çš„å›¢é˜Ÿ`ã€`å…¬å¸æ–‡æ¡£`
2. **å·¥ä½œç©ºé—´ URL**ï¼šè‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä¿®æ”¹
3. ç‚¹å‡» **åˆ›å»ºå·¥ä½œç©ºé—´**

> ğŸ’¡ **æç¤º**ï¼šç¬¬ä¸€ä¸ªæ³¨å†Œçš„ç”¨æˆ·è‡ªåŠ¨æˆä¸ºç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™ã€‚

### 6.3 å¼€å§‹ä½¿ç”¨

åˆå§‹åŒ–å®Œæˆåï¼Œä½ å¯ä»¥ï¼š

1. **åˆ›å»ºæ–‡æ¡£åº“ï¼ˆSpaceï¼‰**
   - ç‚¹å‡»å·¦ä¾§ **+** æŒ‰é’®
   - é€‰æ‹© **æ–°å»ºæ–‡æ¡£åº“**
   - è®¾ç½®åç§°å’Œå›¾æ ‡

2. **åˆ›å»ºé¡µé¢ï¼ˆPageï¼‰**
   - åœ¨æ–‡æ¡£åº“ä¸­ç‚¹å‡» **æ–°å»ºé¡µé¢**
   - å¼€å§‹ç¼–å†™æ–‡æ¡£

3. **é‚€è¯·æˆå‘˜**
   - ç‚¹å‡»å³ä¸Šè§’å¤´åƒ
   - é€‰æ‹© **å·¥ä½œç©ºé—´è®¾ç½®**
   - è¿›å…¥ **æˆå‘˜** æ ‡ç­¾
   - ç‚¹å‡» **é‚€è¯·æˆå‘˜**

4. **é…ç½®æƒé™**
   - åœ¨å·¥ä½œç©ºé—´è®¾ç½®ä¸­é…ç½®ç”¨æˆ·ç»„
   - ä¸ºæ–‡æ¡£åº“è®¾ç½®è®¿é—®æƒé™

### 6.4 åŠŸèƒ½æ¦‚è§ˆ

NoteDoc æä¾›ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

**æ–‡æ¡£ç®¡ç†**ï¼š
- ğŸ“ å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆæ”¯æŒ Markdownï¼‰
- ğŸ“Š è¡¨æ ¼ã€ä»£ç å—ã€ä»»åŠ¡åˆ—è¡¨
- ğŸ¨ Draw.ioã€Excalidrawã€Mermaid å›¾è¡¨
- ğŸ“ æ–‡ä»¶é™„ä»¶å’Œå›¾ç‰‡ä¸Šä¼ 
- ğŸ”— é¡µé¢é“¾æ¥å’ŒåµŒå…¥

**åä½œåŠŸèƒ½**ï¼š
- ğŸ‘¥ å®æ—¶å¤šäººåä½œç¼–è¾‘
- ğŸ’¬ è¯„è®ºå’Œè®¨è®º
- ğŸ”” @æåŠå’Œé€šçŸ¥
- ğŸ“œ é¡µé¢å†å²å’Œç‰ˆæœ¬æ§åˆ¶

**æƒé™ç®¡ç†**ï¼š
- ğŸ‘¤ ç”¨æˆ·å’Œç”¨æˆ·ç»„ç®¡ç†
- ğŸ” ç»†ç²’åº¦æƒé™æ§åˆ¶
- ğŸ”— å…¬å¼€åˆ†äº«é“¾æ¥

**ä¼ä¸šåŠŸèƒ½**ï¼ˆä¼ä¸šç‰ˆï¼‰ï¼š
- ğŸ”‘ SSO å•ç‚¹ç™»å½•
- ğŸ”’ MFA å¤šå› ç´ è®¤è¯
- ğŸ”Œ API å¯†é’¥ç®¡ç†
- ğŸ“¥ Confluence/é£ä¹¦å¯¼å…¥

### 6.5 é…ç½®é‚®ä»¶æœåŠ¡ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦å‘é€é‚®ä»¶é€šçŸ¥ï¼Œç¼–è¾‘ `docker-compose.yml` æ·»åŠ é‚®ä»¶é…ç½®ï¼š

```yaml
environment:
  # ... å…¶ä»–é…ç½® ...
  
  # é‚®ä»¶é…ç½®
  MAIL_DRIVER: 'smtp'
  MAIL_FROM_ADDRESS: 'noreply@your-domain.com'
  MAIL_FROM_NAME: 'NoteDoc'
  
  # Gmail ç¤ºä¾‹
  SMTP_HOST: 'smtp.gmail.com'
  SMTP_PORT: '587'
  SMTP_USERNAME: 'your-email@gmail.com'
  SMTP_PASSWORD: 'your-app-password'  # Gmail åº”ç”¨ä¸“ç”¨å¯†ç 
  SMTP_SECURE: 'false'
  
  # æˆ–ä½¿ç”¨å…¶ä»–é‚®ä»¶æœåŠ¡
  # é˜¿é‡Œäº‘é‚®ä»¶
  # SMTP_HOST: 'smtp.mxhichina.com'
  # SMTP_PORT: '465'
  # SMTP_SECURE: 'true'
  
  # è…¾è®¯ä¼ä¸šé‚®ç®±
  # SMTP_HOST: 'smtp.exmail.qq.com'
  # SMTP_PORT: '465'
  # SMTP_SECURE: 'true'
```

é…ç½®åé‡å¯æœåŠ¡ï¼š
```bash
cd /www/wwwroot/notedoc
docker-compose down
docker-compose up -d
```

## ä¸ƒã€æ—¥å¸¸ç»´æŠ¤å’Œç®¡ç†

### 7.1 æŸ¥çœ‹æ—¥å¿—

**æ–¹æ³• 1ï¼šé€šè¿‡å®å¡” Docker ç®¡ç†å™¨**

1. æ‰“å¼€å®å¡”é¢æ¿ **Docker** > **å®¹å™¨**
2. æ‰¾åˆ°å¯¹åº”çš„å®¹å™¨
3. ç‚¹å‡»å³ä¾§ **æ—¥å¿—** æŒ‰é’®æŸ¥çœ‹

**æ–¹æ³• 2ï¼šé€šè¿‡å‘½ä»¤è¡Œ**

```bash
cd /www/wwwroot/notedoc

# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs

# å®æ—¶æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs -f notedoc

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
docker-compose logs --tail=100 notedoc

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs db

# æŸ¥çœ‹ Redis æ—¥å¿—
docker-compose logs redis
```

### 7.2 é‡å¯æœåŠ¡

**æ–¹æ³• 1ï¼šé€šè¿‡å®å¡” Docker ç®¡ç†å™¨**

1. åœ¨ **Docker** > **å®¹å™¨** ä¸­
2. æ‰¾åˆ°å®¹å™¨ï¼Œç‚¹å‡»å³ä¾§ **é‡å¯** æŒ‰é’®

**æ–¹æ³• 2ï¼šé€šè¿‡å‘½ä»¤è¡Œ**

```bash
cd /www/wwwroot/notedoc

# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart

# é‡å¯å•ä¸ªæœåŠ¡
docker-compose restart notedoc

# ä¼˜é›…é‡å¯ï¼ˆå…ˆåœæ­¢å†å¯åŠ¨ï¼‰
docker-compose down
docker-compose up -d
```

### 7.3 åœæ­¢å’Œå¯åŠ¨æœåŠ¡

```bash
cd /www/wwwroot/notedoc

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose stop

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose start

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨ï¼ˆæ•°æ®ä¸ä¼šä¸¢å¤±ï¼‰
docker-compose down

# é‡æ–°åˆ›å»ºå¹¶å¯åŠ¨
docker-compose up -d
```

### 7.4 æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬

**æ­¥éª¤ 1ï¼šå¤‡ä»½æ•°æ®ï¼ˆé‡è¦ï¼ï¼‰**

åœ¨æ›´æ–°å‰å…ˆå¤‡ä»½æ•°æ®ï¼ˆå‚è§ 7.5 èŠ‚ï¼‰ã€‚

**æ­¥éª¤ 2ï¼šæ‹‰å–æœ€æ–°é•œåƒ**

```bash
cd /www/wwwroot/notedoc

# æ‹‰å–æœ€æ–°ç‰ˆæœ¬
docker-compose pull

# è¾“å‡ºç¤ºä¾‹ï¼š
# [+] Pulling 3/3
#  âœ” notedoc Pulled
#  âœ” db Pulled
#  âœ” redis Pulled
```

**æ­¥éª¤ 3ï¼šé‡å¯æœåŠ¡**

```bash
# åœæ­¢æ—§å®¹å™¨
docker-compose down

# å¯åŠ¨æ–°å®¹å™¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ
docker-compose logs -f notedoc
```

**æ­¥éª¤ 4ï¼šæ¸…ç†æ—§é•œåƒï¼ˆå¯é€‰ï¼‰**

```bash
# æŸ¥çœ‹æ‰€æœ‰é•œåƒ
docker images

# åˆ é™¤æ—§çš„æœªä½¿ç”¨é•œåƒ
docker image prune -a
```

### 7.5 æ•°æ®å¤‡ä»½

**æ–¹æ³• 1ï¼šæ‰‹åŠ¨å¤‡ä»½**

```bash
# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p /www/backup/notedoc

# å¤‡ä»½æ•°æ®åº“
docker exec notedoc_db pg_dump -U notedoc notedoc | gzip > /www/backup/notedoc/db_$(date +%Y%m%d_%H%M%S).sql.gz

# å¤‡ä»½æ–‡ä»¶å­˜å‚¨
docker run --rm \
  -v notedoc_notedoc_data:/data \
  -v /www/backup/notedoc:/backup \
  alpine tar czf /backup/files_$(date +%Y%m%d_%H%M%S).tar.gz -C /data .

# å¤‡ä»½é…ç½®æ–‡ä»¶
cp /www/wwwroot/notedoc/docker-compose.yml /www/backup/notedoc/docker-compose_$(date +%Y%m%d).yml

echo "å¤‡ä»½å®Œæˆï¼"
ls -lh /www/backup/notedoc/
```

**æ–¹æ³• 2ï¼šä½¿ç”¨å®å¡”è®¡åˆ’ä»»åŠ¡è‡ªåŠ¨å¤‡ä»½**

1. åœ¨å®å¡”é¢æ¿ç‚¹å‡» **è®¡åˆ’ä»»åŠ¡**
2. ç‚¹å‡» **æ·»åŠ è®¡åˆ’ä»»åŠ¡**
3. å¡«å†™é…ç½®ï¼š
   - **ä»»åŠ¡ç±»å‹**ï¼šShell è„šæœ¬
   - **ä»»åŠ¡åç§°**ï¼šNoteDoc è‡ªåŠ¨å¤‡ä»½
   - **æ‰§è¡Œå‘¨æœŸ**ï¼šæ¯å¤©å‡Œæ™¨ 2 ç‚¹
   - **è„šæœ¬å†…å®¹**ï¼š

```bash
#!/bin/bash

# å¤‡ä»½ç›®å½•
BACKUP_DIR="/www/backup/notedoc"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
docker exec notedoc_db pg_dump -U notedoc notedoc | gzip > $BACKUP_DIR/db_$DATE.sql.gz

# å¤‡ä»½æ–‡ä»¶
docker run --rm \
  -v notedoc_notedoc_data:/data \
  -v $BACKUP_DIR:/backup \
  alpine tar czf /backup/files_$DATE.tar.gz -C /data .

# åˆ é™¤ 30 å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.gz" -mtime +30 -delete

# è®°å½•æ—¥å¿—
echo "$(date): å¤‡ä»½å®Œæˆ" >> $BACKUP_DIR/backup.log
```

4. ç‚¹å‡» **ç¡®å®š**

**æ–¹æ³• 3ï¼šå¤‡ä»½åˆ°äº‘å­˜å‚¨ï¼ˆæ¨èï¼‰**

å¯ä»¥ä½¿ç”¨ rclone å°†å¤‡ä»½åŒæ­¥åˆ°é˜¿é‡Œäº‘ OSSã€è…¾è®¯äº‘ COS ç­‰ï¼š

```bash
# å®‰è£… rclone
curl https://rclone.org/install.sh | sudo bash

# é…ç½®äº‘å­˜å‚¨
rclone config

# åŒæ­¥å¤‡ä»½åˆ°äº‘ç«¯
rclone sync /www/backup/notedoc remote:notedoc-backup
```

### 7.6 æ•°æ®æ¢å¤

**æ¢å¤æ•°æ®åº“**ï¼š

```bash
# è§£å‹å¤‡ä»½æ–‡ä»¶
gunzip /www/backup/notedoc/db_20241127_020000.sql.gz

# æ¢å¤æ•°æ®åº“
docker exec -i notedoc_db psql -U notedoc notedoc < /www/backup/notedoc/db_20241127_020000.sql
```

**æ¢å¤æ–‡ä»¶å­˜å‚¨**ï¼š

```bash
# åœæ­¢æœåŠ¡
cd /www/wwwroot/notedoc
docker-compose down

# æ¢å¤æ–‡ä»¶
docker run --rm \
  -v notedoc_notedoc_data:/data \
  -v /www/backup/notedoc:/backup \
  alpine sh -c "cd /data && tar xzf /backup/files_20241127_020000.tar.gz"

# å¯åŠ¨æœåŠ¡
docker-compose up -d
```

### 7.7 ç›‘æ§å’Œæ€§èƒ½

**æŸ¥çœ‹èµ„æºä½¿ç”¨**ï¼š

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹ Docker ç£ç›˜ä½¿ç”¨
docker system df
```

**æ¸…ç† Docker èµ„æº**ï¼š

```bash
# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune -a

# æ¸…ç†æœªä½¿ç”¨çš„å®¹å™¨
docker container prune

# æ¸…ç†æœªä½¿ç”¨çš„å·ï¼ˆè°¨æ…ä½¿ç”¨ï¼ï¼‰
docker volume prune

# æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æº
docker system prune -a
```

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š

1. **å¢åŠ æœåŠ¡å™¨é…ç½®**ï¼šå¦‚æœç”¨æˆ·è¾ƒå¤šï¼Œå»ºè®®å‡çº§åˆ° 4 æ ¸ 8GB
2. **ä½¿ç”¨ SSD ç¡¬ç›˜**ï¼šæå‡æ•°æ®åº“æ€§èƒ½
3. **é…ç½® CDN**ï¼šåŠ é€Ÿé™æ€èµ„æºè®¿é—®
4. **å¯ç”¨ Redis æŒä¹…åŒ–**ï¼šå·²åœ¨é…ç½®ä¸­å¯ç”¨
5. **å®šæœŸæ¸…ç†æ—¥å¿—**ï¼šé¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§

## å…«ã€æ•…éšœæ’æŸ¥

### 8.0 å®å¡” Docker ç®¡ç†å™¨ç•Œé¢é—®é¢˜

**ç—‡çŠ¶**ï¼šæ‰¾ä¸åˆ° "Compose" é€‰é¡¹æˆ– "é¡¹ç›®è·¯å¾„" è¾“å…¥æ¡†

**åŸå› **ï¼šå®å¡” Docker ç®¡ç†å™¨æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç•Œé¢å·®å¼‚å¾ˆå¤§

**è§£å†³æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ 1ï¼šä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼ï¼ˆæ¨èï¼‰**

å®Œå…¨ä¸ä¾èµ–å®å¡”ç•Œé¢ï¼Œç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œï¼š

```bash
# æ‰“å¼€å®å¡”ç»ˆç«¯æˆ– SSH è¿æ¥
cd /www/wwwroot/notedoc
docker-compose up -d
```

è¿™æ˜¯æœ€å¯é çš„æ–¹å¼ï¼Œé€‚ç”¨äºæ‰€æœ‰å®å¡”ç‰ˆæœ¬ã€‚

**æ–¹æ¡ˆ 2ï¼šå‡çº§å®å¡” Docker ç®¡ç†å™¨**

1. åœ¨å®å¡”é¢æ¿ **è½¯ä»¶å•†åº—** ä¸­
2. æ‰¾åˆ° **Docker ç®¡ç†å™¨**
3. ç‚¹å‡» **æ›´æ–°** åˆ°æœ€æ–°ç‰ˆæœ¬
4. é‡æ–°å°è¯•

**æ–¹æ¡ˆ 3ï¼šæ‰‹åŠ¨åˆ›å»ºå®¹å™¨ï¼ˆä¸æ¨èï¼‰**

å¦‚æœå¿…é¡»ä½¿ç”¨ç•Œé¢ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»º 3 ä¸ªå®¹å™¨ï¼š
- notedocï¼ˆåº”ç”¨ï¼‰
- notedoc_dbï¼ˆæ•°æ®åº“ï¼‰
- notedoc_redisï¼ˆç¼“å­˜ï¼‰

ä½†è¿™æ ·é…ç½®å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™ï¼Œ**å¼ºçƒˆå»ºè®®ä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼**ã€‚

**æ–¹æ¡ˆ 4ï¼šæŸ¥çœ‹å®å¡” Docker ç®¡ç†å™¨æ–‡æ¡£**

ä¸åŒç‰ˆæœ¬çš„æ“ä½œæ–¹å¼å¯èƒ½ä¸åŒï¼Œå¯ä»¥æŸ¥çœ‹å®å¡”å®˜æ–¹æ–‡æ¡£ï¼š
- å®å¡”è®ºå›ï¼šhttps://www.bt.cn/bbs/
- æœç´¢ "Docker Compose" ç›¸å…³æ•™ç¨‹

---

### 8.1 å®¹å™¨æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**ï¼šè¿è¡Œ `docker-compose up -d` åå®¹å™¨ç«‹å³é€€å‡º

**æ’æŸ¥æ­¥éª¤**ï¼š

1. **æŸ¥çœ‹å®¹å™¨çŠ¶æ€**ï¼š
```bash
cd /www/wwwroot/notedoc
docker-compose ps

# å¦‚æœçŠ¶æ€æ˜¯ Exitï¼ŒæŸ¥çœ‹é€€å‡ºä»£ç 
```

2. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**ï¼š
```bash
docker-compose logs notedoc
docker-compose logs db
docker-compose logs redis
```

**å¸¸è§åŸå› å’Œè§£å†³æ–¹æ¡ˆ**ï¼š

**é—®é¢˜ Aï¼šç«¯å£è¢«å ç”¨**
```bash
# é”™è¯¯ä¿¡æ¯ï¼šBind for 0.0.0.0:3000 failed: port is already allocated

# è§£å†³æ–¹æ¡ˆ 1ï¼šæŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -tlnp | grep 3000
# æˆ–
lsof -i:3000

# æ€æ­»å ç”¨è¿›ç¨‹
kill -9 <PID>

# è§£å†³æ–¹æ¡ˆ 2ï¼šä¿®æ”¹ç«¯å£æ˜ å°„
# ç¼–è¾‘ docker-compose.yml
ports:
  - "3001:3000"  # æ”¹ä¸ºå…¶ä»–ç«¯å£
```

**é—®é¢˜ Bï¼šé…ç½®é”™è¯¯**
```bash
# é”™è¯¯ä¿¡æ¯ï¼šEnvironment variable not set

# è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥ docker-compose.yml ä¸­çš„ç¯å¢ƒå˜é‡
# ç¡®ä¿æ‰€æœ‰å¿…éœ€çš„å˜é‡éƒ½å·²è®¾ç½®
```

**é—®é¢˜ Cï¼šæƒé™é—®é¢˜**
```bash
# é”™è¯¯ä¿¡æ¯ï¼šPermission denied

# è§£å†³æ–¹æ¡ˆï¼šä¿®å¤ç›®å½•æƒé™
sudo chown -R 1000:1000 /www/wwwroot/notedoc
```

### 8.2 æ— æ³•è®¿é—®ç½‘ç«™

**ç—‡çŠ¶**ï¼šæµè§ˆå™¨æ— æ³•æ‰“å¼€ç½‘ç«™ï¼Œæ˜¾ç¤º"æ— æ³•è®¿é—®æ­¤ç½‘ç«™"

**æ’æŸ¥æ­¥éª¤**ï¼š

1. **æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œ**ï¼š
```bash
docker-compose ps

# æ‰€æœ‰å®¹å™¨çŠ¶æ€åº”è¯¥æ˜¯ Up
```

2. **æ£€æŸ¥ç«¯å£ç›‘å¬**ï¼š
```bash
# æ£€æŸ¥ 3000 ç«¯å£æ˜¯å¦ç›‘å¬
netstat -tlnp | grep 3000

# æˆ–
ss -tlnp | grep 3000
```

3. **æµ‹è¯•æœ¬åœ°è®¿é—®**ï¼š
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•
curl http://localhost:3000

# åº”è¯¥è¿”å› HTML å†…å®¹
```

4. **æ£€æŸ¥é˜²ç«å¢™**ï¼š
```bash
# å®å¡”é¢æ¿é˜²ç«å¢™
# è¿›å…¥ å®‰å…¨ > æŸ¥çœ‹æ˜¯å¦å¼€æ”¾äº†ç›¸åº”ç«¯å£

# ç³»ç»Ÿé˜²ç«å¢™ï¼ˆCentOSï¼‰
sudo firewall-cmd --list-all

# ç³»ç»Ÿé˜²ç«å¢™ï¼ˆUbuntuï¼‰
sudo ufw status
```

5. **æ£€æŸ¥äº‘æœåŠ¡å™¨å®‰å…¨ç»„**ï¼š
- ç™»å½•äº‘æœåŠ¡å•†æ§åˆ¶å°
- æ£€æŸ¥å®‰å…¨ç»„è§„åˆ™
- ç¡®ä¿å¼€æ”¾äº† 80 å’Œ 443 ç«¯å£

6. **æ£€æŸ¥åå‘ä»£ç†é…ç½®**ï¼š
```bash
# æµ‹è¯• Nginx é…ç½®
nginx -t

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/nginx_error.log
```

7. **æ£€æŸ¥åŸŸåè§£æ**ï¼š
```bash
# æ£€æŸ¥åŸŸåæ˜¯å¦è§£æåˆ°æ­£ç¡®çš„ IP
ping doc.example.com

# æˆ–
nslookup doc.example.com
```

### 8.3 æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼šåº”ç”¨æ—¥å¿—æ˜¾ç¤ºæ•°æ®åº“è¿æ¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯ç¤ºä¾‹**ï¼š
```
Error: connect ECONNREFUSED 127.0.0.1:5432
æˆ–
FATAL: password authentication failed for user "notedoc"
```

**æ’æŸ¥æ­¥éª¤**ï¼š

1. **æ£€æŸ¥æ•°æ®åº“å®¹å™¨çŠ¶æ€**ï¼š
```bash
docker-compose ps db

# åº”è¯¥æ˜¾ç¤º Up
```

2. **æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—**ï¼š
```bash
docker-compose logs db

# æŸ¥æ‰¾é”™è¯¯ä¿¡æ¯
```

3. **éªŒè¯æ•°æ®åº“è¿æ¥**ï¼š
```bash
# è¿›å…¥æ•°æ®åº“å®¹å™¨
docker exec -it notedoc_db psql -U notedoc -d notedoc

# å¦‚æœèƒ½è¿›å…¥ï¼Œè¯´æ˜æ•°æ®åº“æ­£å¸¸
# è¾“å…¥ \q é€€å‡º
```

4. **æ£€æŸ¥å¯†ç ä¸€è‡´æ€§**ï¼š
```bash
# ç¡®ä¿ docker-compose.yml ä¸­ï¼š
# - POSTGRES_PASSWORD çš„å€¼
# - DATABASE_URL ä¸­çš„å¯†ç 
# ä¸¤è€…å¿…é¡»å®Œå…¨ä¸€è‡´
```

5. **é‡ç½®æ•°æ®åº“**ï¼ˆè°¨æ…ï¼ä¼šä¸¢å¤±æ•°æ®ï¼‰ï¼š
```bash
cd /www/wwwroot/notedoc

# åœæ­¢æœåŠ¡
docker-compose down

# åˆ é™¤æ•°æ®åº“å·
docker volume rm notedoc_db_data

# é‡æ–°å¯åŠ¨
docker-compose up -d
```

### 8.4 æ–‡ä»¶ä¸Šä¼ å¤±è´¥

**ç—‡çŠ¶**ï¼šä¸Šä¼ æ–‡ä»¶æ—¶æŠ¥é”™æˆ–ä¸Šä¼ åæ— æ³•è®¿é—®

**æ’æŸ¥æ­¥éª¤**ï¼š

1. **æ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶**ï¼š
```bash
# åœ¨ docker-compose.yml ä¸­è®¾ç½®
FILE_UPLOAD_SIZE_LIMIT: '50mb'

# åœ¨ Nginx é…ç½®ä¸­è®¾ç½®
client_max_body_size 50m;
```

2. **æ£€æŸ¥å­˜å‚¨å·æƒé™**ï¼š
```bash
# æŸ¥çœ‹å·ä¿¡æ¯
docker volume inspect notedoc_notedoc_data

# æ£€æŸ¥å®¹å™¨å†…æƒé™
docker exec notedoc ls -la /app/data/storage
```

3. **æ£€æŸ¥ç£ç›˜ç©ºé—´**ï¼š
```bash
df -h

# ç¡®ä¿æœ‰è¶³å¤Ÿçš„å¯ç”¨ç©ºé—´
```

### 8.5 SSL è¯ä¹¦é—®é¢˜

**ç—‡çŠ¶**ï¼šHTTPS è®¿é—®æ˜¾ç¤ºè¯ä¹¦é”™è¯¯

**æ’æŸ¥æ­¥éª¤**ï¼š

1. **æ£€æŸ¥è¯ä¹¦çŠ¶æ€**ï¼š
```bash
# åœ¨å®å¡”é¢æ¿ ç½‘ç«™ > SSL ä¸­æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ
```

2. **æµ‹è¯•è¯ä¹¦**ï¼š
```bash
# ä½¿ç”¨ openssl æµ‹è¯•
openssl s_client -connect doc.example.com:443 -servername doc.example.com

# æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯
```

3. **é‡æ–°ç”³è¯·è¯ä¹¦**ï¼š
- åœ¨å®å¡”é¢æ¿ SSL é¡µé¢
- åˆ é™¤ç°æœ‰è¯ä¹¦
- é‡æ–°ç”³è¯· Let's Encrypt è¯ä¹¦

4. **æ£€æŸ¥åŸŸåè§£æ**ï¼š
```bash
# ç¡®ä¿åŸŸåæ­£ç¡®è§£æåˆ°æœåŠ¡å™¨ IP
nslookup doc.example.com
```

### 8.6 æ€§èƒ½é—®é¢˜

**ç—‡çŠ¶**ï¼šè®¿é—®é€Ÿåº¦æ…¢ï¼Œå“åº”æ—¶é—´é•¿

**æ’æŸ¥æ­¥éª¤**ï¼š

1. **æ£€æŸ¥æœåŠ¡å™¨èµ„æº**ï¼š
```bash
# æŸ¥çœ‹ CPU å’Œå†…å­˜ä½¿ç”¨
top

# æŸ¥çœ‹ç£ç›˜ IO
iostat -x 1

# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats
```

2. **æ£€æŸ¥æ•°æ®åº“æ€§èƒ½**ï¼š
```bash
# è¿›å…¥æ•°æ®åº“å®¹å™¨
docker exec -it notedoc_db psql -U notedoc -d notedoc

# æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM pg_stat_activity WHERE state = 'active';
```

3. **ä¼˜åŒ–å»ºè®®**ï¼š

**å¢åŠ æœåŠ¡å™¨é…ç½®**ï¼š
- å‡çº§åˆ° 4 æ ¸ 8GB æˆ–æ›´é«˜
- ä½¿ç”¨ SSD ç¡¬ç›˜

**å¯ç”¨ Nginx ç¼“å­˜**ï¼š
```nginx
# åœ¨åå‘ä»£ç†é…ç½®ä¸­æ·»åŠ 
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=notedoc_cache:10m max_size=1g inactive=60m;

location / {
    proxy_cache notedoc_cache;
    proxy_cache_valid 200 10m;
    # ... å…¶ä»–é…ç½®
}
```

**é…ç½® CDN**ï¼š
- ä½¿ç”¨é˜¿é‡Œäº‘ CDNã€è…¾è®¯äº‘ CDN ç­‰
- åŠ é€Ÿé™æ€èµ„æºè®¿é—®

**æ•°æ®åº“ä¼˜åŒ–**ï¼š
```bash
# å¢åŠ  PostgreSQL è¿æ¥æ± 
# åœ¨ docker-compose.yml ä¸­æ·»åŠ 
command: postgres -c max_connections=200 -c shared_buffers=256MB
```

### 8.7 æ—¥å¿—æ–‡ä»¶è¿‡å¤§

**ç—‡çŠ¶**ï¼šç£ç›˜ç©ºé—´ä¸è¶³ï¼ŒDocker æ—¥å¿—å ç”¨å¤§é‡ç©ºé—´

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æŸ¥çœ‹ Docker æ—¥å¿—å¤§å°
du -sh /var/lib/docker/containers/*/*-json.log

# æ¸…ç†æ—¥å¿—
truncate -s 0 /var/lib/docker/containers/*/*-json.log

# é…ç½®æ—¥å¿—è½®è½¬
# ç¼–è¾‘ /etc/docker/daemon.json
{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}

# é‡å¯ Docker
systemctl restart docker
```

### 8.8 è·å–å¸®åŠ©

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. **æŸ¥çœ‹å®Œæ•´æ—¥å¿—**ï¼š
```bash
docker-compose logs --tail=200 > /tmp/notedoc-logs.txt
```

2. **æ”¶é›†ç³»ç»Ÿä¿¡æ¯**ï¼š
```bash
# ç³»ç»Ÿä¿¡æ¯
uname -a
cat /etc/os-release

# Docker ç‰ˆæœ¬
docker --version
docker-compose --version

# å®¹å™¨çŠ¶æ€
docker-compose ps
```

3. **æäº¤ Issue**ï¼š
- GitHub: https://github.com/onlinedear/wiki/issues
- é™„ä¸Šæ—¥å¿—å’Œç³»ç»Ÿä¿¡æ¯
- æè¿°è¯¦ç»†çš„å¤ç°æ­¥éª¤

4. **ç¤¾åŒºè®¨è®º**ï¼š
- è®¨è®ºåŒº: https://github.com/onlinedear/wiki/discussions

## ä¹ã€å®‰å…¨åŠ å›º

### 9.1 å¿…é¡»é…ç½®çš„å®‰å…¨æªæ–½

**1. ä½¿ç”¨å¼ºå¯†ç **

```bash
# APP_SECRET å¿…é¡»æ˜¯ 64 ä½éšæœºå­—ç¬¦ä¸²
openssl rand -hex 32

# æ•°æ®åº“å¯†ç è‡³å°‘ 24 ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
openssl rand -base64 24
```

**2. å¯ç”¨ HTTPS**

- ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPS
- ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦
- å¼€å¯å¼ºåˆ¶ HTTPS è·³è½¬
- å¯ç”¨ HSTS å¤´

**3. å®šæœŸæ›´æ–°**

```bash
# æ¯æœˆè‡³å°‘æ£€æŸ¥ä¸€æ¬¡æ›´æ–°
cd /www/wwwroot/notedoc
docker-compose pull
docker-compose down
docker-compose up -d
```

**4. é…ç½®è‡ªåŠ¨å¤‡ä»½**

- ä½¿ç”¨å®å¡”è®¡åˆ’ä»»åŠ¡æ¯å¤©è‡ªåŠ¨å¤‡ä»½
- å¤‡ä»½ä¿ç•™è‡³å°‘ 30 å¤©
- å®šæœŸæµ‹è¯•å¤‡ä»½æ¢å¤

### 9.2 æ¨èçš„å®‰å…¨æªæ–½

**1. é™åˆ¶è®¿é—® IPï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰**

åœ¨å®å¡”é¢æ¿ç½‘ç«™è®¾ç½®ä¸­ï¼š
1. ç‚¹å‡» **è®¿é—®é™åˆ¶**
2. æ·»åŠ å…è®¸è®¿é—®çš„ IP åœ°å€
3. æ‹’ç»å…¶ä»–æ‰€æœ‰ IP

**2. é…ç½® Redis å¯†ç **

ç¼–è¾‘ `docker-compose.yml`ï¼š
```yaml
redis:
  command: redis-server --appendonly yes --requirepass your-redis-password

notedoc:
  environment:
    REDIS_URL: 'redis://:your-redis-password@redis:6379'
```

**3. ç¦ç”¨ä¸å¿…è¦çš„ç«¯å£**

- ä¸è¦å¯¹å¤–å¼€æ”¾ 3000 ç«¯å£ï¼ˆä½¿ç”¨åå‘ä»£ç†ï¼‰
- ä¸è¦å¯¹å¤–å¼€æ”¾ 5432 ç«¯å£ï¼ˆæ•°æ®åº“ï¼‰
- ä¸è¦å¯¹å¤–å¼€æ”¾ 6379 ç«¯å£ï¼ˆRedisï¼‰

**4. é…ç½® fail2ban é˜²æš´åŠ›ç ´è§£**

```bash
# å®‰è£… fail2ban
sudo apt install fail2ban -y

# é…ç½®è§„åˆ™
sudo nano /etc/fail2ban/jail.local

# æ·»åŠ ï¼š
[nginx-limit-req]
enabled = true
filter = nginx-limit-req
action = iptables-multiport[name=ReqLimit, port="http,https"]
logpath = /www/wwwlogs/*.log
findtime = 600
bantime = 7200
maxretry = 10
```

**5. å®šæœŸæ£€æŸ¥æ—¥å¿—**

```bash
# æ£€æŸ¥è®¿é—®æ—¥å¿—
tail -f /www/wwwlogs/doc.example.com.log

# æ£€æŸ¥é”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/doc.example.com.error.log

# æ£€æŸ¥åº”ç”¨æ—¥å¿—
docker-compose logs --tail=100 notedoc
```

### 9.3 æ•°æ®å®‰å…¨

**1. åŠ å¯†æ•æ„Ÿæ•°æ®**

- APP_SECRET å¿…é¡»ä¿å¯†ï¼Œä¸è¦æäº¤åˆ°ä»£ç ä»“åº“
- æ•°æ®åº“å¯†ç å®šæœŸæ›´æ¢
- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯

**2. é…ç½®æ•°æ®åº“å¤‡ä»½åŠ å¯†**

```bash
# å¤‡ä»½æ—¶åŠ å¯†
docker exec notedoc_db pg_dump -U notedoc notedoc | \
  gzip | \
  openssl enc -aes-256-cbc -salt -out /www/backup/notedoc/db_$(date +%Y%m%d).sql.gz.enc

# æ¢å¤æ—¶è§£å¯†
openssl enc -aes-256-cbc -d -in backup.sql.gz.enc | \
  gunzip | \
  docker exec -i notedoc_db psql -U notedoc notedoc
```

**3. é…ç½®æ–‡ä»¶æƒé™**

```bash
# é™åˆ¶é…ç½®æ–‡ä»¶æƒé™
chmod 600 /www/wwwroot/notedoc/docker-compose.yml
chown root:root /www/wwwroot/notedoc/docker-compose.yml
```

### 9.4 ç›‘æ§å’Œå‘Šè­¦

**1. é…ç½®å®å¡”ç›‘æ§**

åœ¨å®å¡”é¢æ¿ä¸­ï¼š
1. å®‰è£… **ç›‘æ§** æ’ä»¶
2. é…ç½®å‘Šè­¦é˜ˆå€¼ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰
3. è®¾ç½®å‘Šè­¦é€šçŸ¥ï¼ˆé‚®ä»¶ã€å¾®ä¿¡ï¼‰

**2. é…ç½®å®¹å™¨å¥åº·æ£€æŸ¥**

ç¼–è¾‘ `docker-compose.yml`ï¼š
```yaml
notedoc:
  healthcheck:
    test: ["CMD", "curl", "-f", "http://localhost:3000/api/health"]
    interval: 30s
    timeout: 10s
    retries: 3
    start_period: 40s
```

**3. é…ç½®æ—¥å¿—ç›‘æ§**

```bash
# ç›‘æ§é”™è¯¯æ—¥å¿—
watch -n 60 'docker-compose logs --tail=50 notedoc | grep -i error'
```

## åã€è¿›é˜¶é…ç½®

### 10.1 é…ç½® S3 å¯¹è±¡å­˜å‚¨

å¦‚æœæ–‡ä»¶è¾ƒå¤šï¼Œå»ºè®®ä½¿ç”¨å¯¹è±¡å­˜å‚¨æ›¿ä»£æœ¬åœ°å­˜å‚¨ã€‚

**æ”¯æŒçš„æœåŠ¡**ï¼š
- AWS S3
- é˜¿é‡Œäº‘ OSS
- è…¾è®¯äº‘ COS
- ä¸ƒç‰›äº‘ Kodo
- MinIOï¼ˆè‡ªå»ºï¼‰

**é…ç½®ç¤ºä¾‹ï¼ˆé˜¿é‡Œäº‘ OSSï¼‰**ï¼š

ç¼–è¾‘ `docker-compose.yml`ï¼š
```yaml
notedoc:
  environment:
    # æ”¹ä¸º s3 å­˜å‚¨
    STORAGE_DRIVER: 's3'
    
    # S3 é…ç½®
    AWS_S3_ACCESS_KEY_ID: 'your-access-key-id'
    AWS_S3_SECRET_ACCESS_KEY: 'your-secret-access-key'
    AWS_S3_REGION: 'oss-cn-hangzhou'
    AWS_S3_BUCKET: 'your-bucket-name'
    AWS_S3_ENDPOINT: 'https://oss-cn-hangzhou.aliyuncs.com'
    AWS_S3_FORCE_PATH_STYLE: 'true'
```

é‡å¯æœåŠ¡ï¼š
```bash
docker-compose down
docker-compose up -d
```

### 10.2 é…ç½®å¤šèŠ‚ç‚¹éƒ¨ç½²ï¼ˆé«˜å¯ç”¨ï¼‰

å¦‚æœéœ€è¦é«˜å¯ç”¨éƒ¨ç½²ï¼Œå¯ä»¥ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“å’Œ Redisï¼š

**æ¶æ„**ï¼š
```
è´Ÿè½½å‡è¡¡å™¨ (Nginx/HAProxy)
    â”œâ”€â”€ NoteDoc èŠ‚ç‚¹ 1
    â”œâ”€â”€ NoteDoc èŠ‚ç‚¹ 2
    â””â”€â”€ NoteDoc èŠ‚ç‚¹ 3
         â”œâ”€â”€ PostgreSQL (ä¸»ä»å¤åˆ¶)
         â””â”€â”€ Redis (å“¨å…µæ¨¡å¼)
```

**é…ç½®ç¤ºä¾‹**ï¼š
```yaml
notedoc:
  environment:
    DATABASE_URL: 'postgresql://user:pass@external-db:5432/notedoc'
    REDIS_URL: 'redis://external-redis:6379'
```

### 10.3 é…ç½®è‡ªå®šä¹‰åŸŸåå’Œå“ç‰Œ

**1. è‡ªå®šä¹‰ Logo å’Œå›¾æ ‡**

ä¸Šä¼ è‡ªå®šä¹‰å›¾æ ‡åˆ° `/www/wwwroot/notedoc/custom/` ç›®å½•ï¼Œç„¶ååœ¨åº”ç”¨è®¾ç½®ä¸­é…ç½®ã€‚

**2. è‡ªå®šä¹‰é‚®ä»¶æ¨¡æ¿**

å¯ä»¥è‡ªå®šä¹‰é‚®ä»¶é€šçŸ¥çš„æ ·å¼å’Œå†…å®¹ã€‚

**3. è‡ªå®šä¹‰ä¸»é¢˜é¢œè‰²**

åœ¨å·¥ä½œç©ºé—´è®¾ç½®ä¸­å¯ä»¥é…ç½®ä¸»é¢˜é¢œè‰²ã€‚

### 10.4 é›†æˆç¬¬ä¸‰æ–¹æœåŠ¡

**1. é…ç½® SSO å•ç‚¹ç™»å½•ï¼ˆä¼ä¸šç‰ˆï¼‰**

æ”¯æŒ SAML 2.0ã€OAuth 2.0ã€OIDC ç­‰åè®®ã€‚

**2. é…ç½® LDAP/AD é›†æˆï¼ˆä¼ä¸šç‰ˆï¼‰**

å¯ä»¥ä¸ä¼ä¸šç°æœ‰çš„ç”¨æˆ·ç›®å½•é›†æˆã€‚

**3. é…ç½® Webhook**

å¯ä»¥é…ç½® Webhook æ¥æ”¶äº‹ä»¶é€šçŸ¥ã€‚

## åä¸€ã€å¸¸è§é—®é¢˜ FAQ

### Q0: å®å¡”ç•Œé¢ä¸­æ‰¾ä¸åˆ° "Compose" é€‰é¡¹æ€ä¹ˆåŠï¼Ÿ

**A**: è¿™æ˜¯æœ€å¸¸è§çš„é—®é¢˜ã€‚å®å¡” Docker ç®¡ç†å™¨æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç•Œé¢å·®å¼‚å¾ˆå¤§ã€‚

**è§£å†³æ–¹æ³•**ï¼š
1. **æ¨èæ–¹å¼**ï¼šä½¿ç”¨å‘½ä»¤è¡Œéƒ¨ç½²ï¼ˆè§ 3.2 èŠ‚ï¼‰
   ```bash
   cd /www/wwwroot/notedoc
   docker-compose up -d
   ```

2. **åŸå› **ï¼š
   - æ–°ç‰ˆå®å¡” Docker ç®¡ç†å™¨ç•Œé¢æ”¹ç‰ˆ
   - éƒ¨åˆ†ç‰ˆæœ¬ä¸æ”¯æŒé€šè¿‡ç•Œé¢åˆ›å»º Compose é¡¹ç›®
   - åªèƒ½åˆ›å»ºå•ä¸ªå®¹å™¨

3. **ä¸ºä»€ä¹ˆæ¨èå‘½ä»¤è¡Œ**ï¼š
   - âœ… é€‚ç”¨äºæ‰€æœ‰å®å¡”ç‰ˆæœ¬
   - âœ… æ›´ç¨³å®šå¯é 
   - âœ… æ›´å®¹æ˜“æ’æŸ¥é—®é¢˜
   - âœ… ä¸å®˜æ–¹æ–‡æ¡£ä¸€è‡´

4. **å¦‚ä½•æ‰“å¼€ç»ˆç«¯**ï¼š
   - åœ¨å®å¡”é¢æ¿å³ä¸Šè§’æ‰¾ "ç»ˆç«¯" å›¾æ ‡
   - æˆ–åœ¨å·¦ä¾§èœå•æ‰¾ "ç»ˆç«¯"
   - æˆ–ä½¿ç”¨ SSH å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨

### Q1: å¦‚ä½•ä¿®æ”¹åº”ç”¨ç«¯å£ï¼Ÿ

A: ç¼–è¾‘ `docker-compose.yml`ï¼Œä¿®æ”¹ç«¯å£æ˜ å°„ï¼š
```yaml
ports:
  - "3001:3000"  # æ”¹ä¸ºå…¶ä»–ç«¯å£
```

### Q2: å¦‚ä½•é‡ç½®ç®¡ç†å‘˜å¯†ç ï¼Ÿ

A: é€šè¿‡æ•°æ®åº“ç›´æ¥ä¿®æ”¹ï¼š
```bash
docker exec -it notedoc_db psql -U notedoc -d notedoc
UPDATE users SET password = crypt('new-password', gen_salt('bf')) WHERE email = 'admin@example.com';
```

### Q3: å¦‚ä½•è¿ç§»åˆ°æ–°æœåŠ¡å™¨ï¼Ÿ

A: 
1. åœ¨æ—§æœåŠ¡å™¨å¤‡ä»½æ•°æ®
2. åœ¨æ–°æœåŠ¡å™¨å®‰è£… Docker å’Œå®å¡”é¢æ¿
3. å¤åˆ¶ `docker-compose.yml` åˆ°æ–°æœåŠ¡å™¨
4. æ¢å¤æ•°æ®åº“å’Œæ–‡ä»¶
5. å¯åŠ¨æœåŠ¡

### Q4: å¦‚ä½•å‡çº§ PostgreSQL ç‰ˆæœ¬ï¼Ÿ

A: éœ€è¦å¯¼å‡ºæ•°æ®ã€å‡çº§é•œåƒã€å¯¼å…¥æ•°æ®ï¼š
```bash
# å¯¼å‡ºæ•°æ®
docker exec notedoc_db pg_dumpall -U notedoc > backup.sql

# ä¿®æ”¹ docker-compose.yml ä¸­çš„é•œåƒç‰ˆæœ¬
# image: postgres:17-alpine

# åˆ é™¤æ—§æ•°æ®
docker-compose down
docker volume rm notedoc_db_data

# å¯åŠ¨æ–°ç‰ˆæœ¬
docker-compose up -d

# å¯¼å…¥æ•°æ®
docker exec -i notedoc_db psql -U notedoc < backup.sql
```

### Q5: å¦‚ä½•é…ç½®å¤šä¸ªå·¥ä½œç©ºé—´ï¼Ÿ

A: NoteDoc æ”¯æŒå¤šå·¥ä½œç©ºé—´ï¼Œæ¯ä¸ªç”¨æˆ·å¯ä»¥åˆ›å»ºå’ŒåŠ å…¥å¤šä¸ªå·¥ä½œç©ºé—´ã€‚

## åäºŒã€ç›¸å…³æ–‡æ¡£

- [æœ¬åœ°å¼€å‘ç¯å¢ƒå¯åŠ¨æŒ‡å—](./æœ¬åœ°å¼€å‘ç¯å¢ƒå¯åŠ¨æŒ‡å—.md)
- [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—](./ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—.md)
- [Vercel éƒ¨ç½²æŒ‡å—](./Verceléƒ¨ç½²æŒ‡å—.md)
- [ä¸€é”®éƒ¨ç½²æ–¹æ¡ˆ](./ä¸€é”®éƒ¨ç½²æ–¹æ¡ˆ.md)
- [éƒ¨ç½²æ–‡æ¡£ç´¢å¼•](./éƒ¨ç½²æ–‡æ¡£ç´¢å¼•.md)

## åä¸‰ã€æŠ€æœ¯æ”¯æŒ

### å®˜æ–¹èµ„æº

- **å®˜æ–¹ç½‘ç«™**: https://notedoc.cn
- **GitHub ä»“åº“**: https://github.com/onlinedear/wiki
- **åœ¨çº¿æ–‡æ¡£**: https://notedoc.cn/docs
- **é—®é¢˜åé¦ˆ**: https://github.com/onlinedear/wiki/issues
- **è®¨è®ºç¤¾åŒº**: https://github.com/onlinedear/wiki/discussions

### è·å–å¸®åŠ©

1. **æŸ¥çœ‹æ–‡æ¡£**ï¼šå…ˆæŸ¥çœ‹ç›¸å…³æ–‡æ¡£å’Œ FAQ
2. **æœç´¢ Issues**ï¼šåœ¨ GitHub Issues ä¸­æœç´¢ç±»ä¼¼é—®é¢˜
3. **æäº¤ Issue**ï¼šå¦‚æœæ˜¯ Bugï¼Œæäº¤è¯¦ç»†çš„é—®é¢˜æŠ¥å‘Š
4. **ç¤¾åŒºè®¨è®º**ï¼šåœ¨ Discussions ä¸­æé—®å’Œäº¤æµ

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·ç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] æ‰€æœ‰å®¹å™¨éƒ½åœ¨è¿è¡Œï¼ˆ`docker-compose ps`ï¼‰
- [ ] å¯ä»¥é€šè¿‡åŸŸåæˆ– IP è®¿é—®åº”ç”¨
- [ ] HTTPS è¯ä¹¦é…ç½®æ­£ç¡®ï¼ˆå¦‚ä½¿ç”¨åŸŸåï¼‰
- [ ] å·²åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·
- [ ] å·²åˆ›å»ºç¬¬ä¸€ä¸ªå·¥ä½œç©ºé—´
- [ ] é˜²ç«å¢™è§„åˆ™é…ç½®æ­£ç¡®
- [ ] å·²é…ç½®è‡ªåŠ¨å¤‡ä»½ä»»åŠ¡
- [ ] APP_SECRET å’Œæ•°æ®åº“å¯†ç å·²å¦¥å–„ä¿å­˜
- [ ] é‚®ä»¶æœåŠ¡é…ç½®æ­£ç¡®ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] å·²æµ‹è¯•æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½

**æ­å–œï¼NoteDoc å·²æˆåŠŸéƒ¨ç½²ï¼Œç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼** ğŸ‰

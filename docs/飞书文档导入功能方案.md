# é£ä¹¦æ–‡æ¡£å¯¼å…¥åŠŸèƒ½å®ç°æ–¹æ¡ˆ

## ä¸€ã€ç°çŠ¶åˆ†æ

### 1.1 PandaWiki å·²æœ‰åŠŸèƒ½

âœ… **PandaWiki å·²ç»å®ç°äº†é£ä¹¦æ–‡æ¡£å¯¼å…¥åŠŸèƒ½ï¼**

æ ¹æ®ä»£ç åˆ†æï¼Œç³»ç»Ÿæ”¯æŒä»¥ä¸‹å¯¼å…¥æ–¹å¼ï¼š
- é€šè¿‡ç¦»çº¿æ–‡ä»¶å¯¼å…¥ï¼ˆ.txt, .md, .docx, .pdf ç­‰ï¼‰
- é€šè¿‡ URL å¯¼å…¥
- é€šè¿‡ RSS å¯¼å…¥
- é€šè¿‡ Sitemap å¯¼å…¥
- é€šè¿‡ Notion å¯¼å…¥
- é€šè¿‡è¯­é›€å¯¼å…¥
- é€šè¿‡æ€æºç¬”è®°å¯¼å…¥
- **é€šè¿‡é£ä¹¦æ–‡æ¡£å¯¼å…¥** âœ…
- é€šè¿‡ Confluence å¯¼å…¥
- ç­‰ç­‰...

### 1.2 é£ä¹¦æ–‡æ¡£å¯¼å…¥çš„å®ç°æ–¹å¼

**é…ç½®æ–¹å¼ï¼šæ¯æ¬¡ä½¿ç”¨æ—¶é…ç½®ï¼ˆç”¨æˆ·çº§åˆ«ï¼‰**

ä¸é£ä¹¦ç™»å½•è®¤è¯ä¸åŒï¼Œé£ä¹¦æ–‡æ¡£å¯¼å…¥**ä¸éœ€è¦ç³»ç»Ÿçº§é…ç½®**ï¼Œè€Œæ˜¯ï¼š
- âœ… æ¯æ¬¡å¯¼å…¥æ—¶ç”±ç”¨æˆ·è¾“å…¥å‡­è¯
- âœ… æ”¯æŒä¸åŒç”¨æˆ·ä½¿ç”¨ä¸åŒçš„é£ä¹¦è´¦å·å¯¼å…¥
- âœ… æ›´çµæ´»ï¼Œä¸éœ€è¦ç®¡ç†å‘˜é¢„å…ˆé…ç½®

---

## äºŒã€é£ä¹¦æ–‡æ¡£å¯¼å…¥è¯¦ç»†è¯´æ˜

### 2.1 åŠŸèƒ½å…¥å£

**ä½ç½®**ï¼šç®¡ç†åå° > æ–‡æ¡£ç®¡ç† > æ·»åŠ æ–‡æ¡£ > é€šè¿‡é£ä¹¦æ–‡æ¡£å¯¼å…¥

### 2.2 æ‰€éœ€å‚æ•°

ç”¨æˆ·éœ€è¦æä¾›ä¸‰ä¸ªå‚æ•°ï¼š

| å‚æ•° | è¯´æ˜ | è·å–æ–¹å¼ |
|------|------|----------|
| **App ID** | é£ä¹¦åº”ç”¨çš„å”¯ä¸€æ ‡è¯† | é£ä¹¦å¼€æ”¾å¹³å° > å‡­è¯ä¸åŸºç¡€ä¿¡æ¯ > åº”ç”¨å‡­è¯ > App ID |
| **App Secret** | é£ä¹¦åº”ç”¨çš„å¯†é’¥ | é£ä¹¦å¼€æ”¾å¹³å° > å‡­è¯ä¸åŸºç¡€ä¿¡æ¯ > åº”ç”¨å‡­è¯ > App Secret |
| **User Access Token** | ç”¨æˆ·è®¿é—®ä»¤ç‰Œ | é€šè¿‡ OAuth è·å–æˆ–æ‰‹åŠ¨ç”Ÿæˆ |

### 2.3 å¯¼å…¥æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»"é€šè¿‡é£ä¹¦æ–‡æ¡£å¯¼å…¥"
   â†“
2. å¼¹å‡ºè¡¨å•ï¼Œå¡«å†™ä¸‰ä¸ªå‚æ•°ï¼š
   - App ID
   - App Secret  
   - User Access Token
   â†“
3. ç‚¹å‡»"æ‹‰å–çŸ¥è¯†åº“"æŒ‰é’®
   â†“
4. åç«¯è°ƒç”¨é£ä¹¦ API è·å–æ–‡æ¡£åˆ—è¡¨
   POST /api/v1/crawler/parse
   {
     "crawler_source": "feishu",
     "feishu_setting": {
       "app_id": "xxx",
       "app_secret": "xxx",
       "user_access_token": "xxx"
     },
     "kb_id": "xxx"
   }
   â†“
5. æ˜¾ç¤º"é£ä¹¦äº‘ç›˜"æ–‡ä»¶å¤¹ï¼ŒåŒ…å«ç”¨æˆ·çš„æ–‡æ¡£åˆ—è¡¨
   â†“
6. ç”¨æˆ·é€‰æ‹©è¦å¯¼å…¥çš„æ–‡æ¡£/æ–‡ä»¶å¤¹
   â†“
7. ç‚¹å‡»å¯¼å…¥ï¼Œæ–‡æ¡£è¢«æ‹‰å–åˆ° PandaWiki
```

### 2.4 å‰ç«¯å®ç°

#### è¡¨å•é…ç½®

**æ–‡ä»¶**: `web/admin/src/pages/document/component/AddDocByType/FormSubmit/FormInput.tsx`

```typescript
[ConstsCrawlerSource.CrawlerSourceFeishu]: [
  {
    label: 'App ID',
    placeholder: '> é£ä¹¦å¼€æ”¾å¹³å° > å‡­è¯ä¸åŸºç¡€ä¿¡æ¯ > åº”ç”¨å‡­è¯ > App ID',
    fieldName: 'app_id',
  },
  {
    label: 'Client Secret',
    placeholder: '> é£ä¹¦å¼€æ”¾å¹³å° > å‡­è¯ä¸åŸºç¡€ä¿¡æ¯ > åº”ç”¨å‡­è¯ > App Secret',
    fieldName: 'app_secret',
  },
  {
    label: 'User Access Token',
    placeholder: '',
    fieldName: 'user_access_token',
  },
]
```

#### æäº¤å¤„ç†

**æ–‡ä»¶**: `web/admin/src/pages/document/component/AddDocByType/FormSubmit/index.tsx`

```typescript
case ConstsCrawlerSource.CrawlerSourceFeishu: {
  const resp = await postApiV1CrawlerParse({
    crawler_source: type,
    feishu_setting: {
      app_id: formData.app_id!,
      app_secret: formData.app_secret!,
      user_access_token: formData.user_access_token!,
    },
    kb_id,
  });

  // åˆ›å»º"é£ä¹¦äº‘ç›˜"æ ¹èŠ‚ç‚¹
  const myfolder: ListDataItem = {
    uuid: uuidv4(),
    task_id: '',
    parent_id: parent_id || '',
    platform_id: resp.id || '',
    id: 'cloud_disk',
    title: 'é£ä¹¦äº‘ç›˜',
    summary: 'cloud_disk',
    file: false,
    status: 'parsed',
    open: true,
    folderReq: false,
    feishu_setting: {
      app_id: formData.app_id!,
      app_secret: formData.app_secret!,
      user_access_token: formData.user_access_token!,
    },
  };

  // å¹³é“ºçŸ¥è¯†åº“åˆ—è¡¨æ•°æ®
  const children = flattenCrawlerParseResponse(resp, parent_id, {
    folderReq: false,
    feishu_setting: {
      app_id: formData.app_id!,
      app_secret: formData.app_secret!,
      user_access_token: formData.user_access_token!,
    },
  });

  setData([myfolder, ...children]);
  break;
}
```

### 2.5 åç«¯å®ç°

#### API ç«¯ç‚¹

**æ–‡ä»¶**: `backend/handler/v1/crawler.go`

```go
// éªŒè¯é£ä¹¦å‚æ•°
if req.CrawlerSource == consts.CrawlerSourceFeishu {
    if req.FeishuSetting.AppID == "" || 
       req.FeishuSetting.AppSecret == "" || 
       req.FeishuSetting.UserAccessToken == "" {
        return h.NewResponseWithError(c, "validate request param feishu failed", nil)
    }
}
```

#### ä¸šåŠ¡é€»è¾‘

**æ–‡ä»¶**: `backend/usecase/crawler.go`

```go
case consts.CrawlerSourceFeishu:
    docs, err = u.anydocClient.FeishuListDocs(
        ctx, 
        id, 
        req.FeishuSetting.AppID, 
        req.FeishuSetting.AppSecret, 
        req.FeishuSetting.UserAccessToken, 
        req.FeishuSetting.SpaceId
    )
    if err != nil {
        return nil, err
    }
```

---

## ä¸‰ã€é…ç½®æ–¹å¼å¯¹æ¯”

### 3.1 ç³»ç»Ÿçº§é…ç½® vs ç”¨æˆ·çº§é…ç½®

| å¯¹æ¯”é¡¹ | ç³»ç»Ÿçº§é…ç½® | ç”¨æˆ·çº§é…ç½®ï¼ˆå½“å‰å®ç°ï¼‰|
|--------|-----------|---------------------|
| **é…ç½®ä½ç½®** | çŸ¥è¯†åº“è®¾ç½® > é£ä¹¦æœºå™¨äºº | æ¯æ¬¡å¯¼å…¥æ—¶è¾“å…¥ |
| **é…ç½®æ¬¡æ•°** | ä¸€æ¬¡é…ç½®ï¼Œæ°¸ä¹…ä½¿ç”¨ | æ¯æ¬¡å¯¼å…¥éƒ½éœ€è¦è¾“å…¥ |
| **é€‚ç”¨åœºæ™¯** | é£ä¹¦æœºå™¨äººã€é£ä¹¦ç™»å½• | é£ä¹¦æ–‡æ¡£å¯¼å…¥ |
| **æƒé™æ§åˆ¶** | ç®¡ç†å‘˜é…ç½® | ä»»ä½•æœ‰æƒé™çš„ç”¨æˆ· |
| **çµæ´»æ€§** | ä½ï¼ˆæ‰€æœ‰äººç”¨åŒä¸€ä¸ªåº”ç”¨ï¼‰| é«˜ï¼ˆæ¯ä¸ªäººå¯ç”¨è‡ªå·±çš„è´¦å·ï¼‰|
| **å®‰å…¨æ€§** | å‡­è¯å­˜å‚¨åœ¨æœåŠ¡å™¨ | å‡­è¯ä¸´æ—¶ä½¿ç”¨ |
| **ç”¨æˆ·ä½“éªŒ** | å¥½ï¼ˆæ— éœ€é‡å¤è¾“å…¥ï¼‰| ä¸€èˆ¬ï¼ˆæ¯æ¬¡éƒ½è¦è¾“å…¥ï¼‰|

### 3.2 å½“å‰å®ç°çš„ä¼˜ç¼ºç‚¹

#### âœ… ä¼˜ç‚¹

1. **çµæ´»æ€§é«˜**
   - ä¸åŒç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¸åŒçš„é£ä¹¦è´¦å·
   - å¯ä»¥å¯¼å…¥ä¸åŒé£ä¹¦ç»„ç»‡çš„æ–‡æ¡£
   - æ— éœ€ç®¡ç†å‘˜é¢„å…ˆé…ç½®

2. **å®‰å…¨æ€§å¥½**
   - å‡­è¯ä¸å­˜å‚¨åœ¨æœåŠ¡å™¨
   - ç”¨æˆ·è‡ªå·±æ§åˆ¶è®¿é—®æƒé™
   - å‡å°‘å‡­è¯æ³„éœ²é£é™©

3. **å®ç°ç®€å•**
   - æ— éœ€å¤æ‚çš„æƒé™ç®¡ç†
   - æ— éœ€å­˜å‚¨å’Œç®¡ç†å‡­è¯
   - å‡å°‘ç³»ç»Ÿå¤æ‚åº¦

#### âŒ ç¼ºç‚¹

1. **ç”¨æˆ·ä½“éªŒå·®**
   - æ¯æ¬¡å¯¼å…¥éƒ½è¦è¾“å…¥ä¸‰ä¸ªå‚æ•°
   - å‚æ•°è·å–è¾ƒå¤æ‚ï¼ˆç‰¹åˆ«æ˜¯ User Access Tokenï¼‰
   - å®¹æ˜“è¾“å…¥é”™è¯¯

2. **æ•ˆç‡ä½**
   - é¢‘ç¹å¯¼å…¥æ—¶é‡å¤æ“ä½œ
   - æ— æ³•è‡ªåŠ¨åŒ–å®šæœŸåŒæ­¥

---

## å››ã€æ”¹è¿›æ–¹æ¡ˆå»ºè®®

### æ–¹æ¡ˆä¸€ï¼šä¿æŒç°çŠ¶ + ä¼˜åŒ–ä½“éªŒ

**é€‚åˆåœºæ™¯**ï¼šå¶å°”å¯¼å…¥ã€å¤šç”¨æˆ·å¤šè´¦å·

**æ”¹è¿›æªæ–½**ï¼š

1. **æµè§ˆå™¨æœ¬åœ°å­˜å‚¨**
   ```typescript
   // ä¿å­˜åˆ° localStorage
   localStorage.setItem('feishu_credentials', JSON.stringify({
     app_id: formData.app_id,
     app_secret: formData.app_secret,
     user_access_token: formData.user_access_token,
     saved_at: Date.now()
   }));
   
   // ä¸‹æ¬¡è‡ªåŠ¨å¡«å……
   const saved = localStorage.getItem('feishu_credentials');
   if (saved) {
     const credentials = JSON.parse(saved);
     setFormData(credentials);
   }
   ```

2. **æ·»åŠ "è®°ä½å‡­è¯"é€‰é¡¹**
   ```tsx
   <FormControlLabel
     control={<Checkbox />}
     label="è®°ä½å‡­è¯ï¼ˆä»…ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ï¼‰"
     onChange={(e) => setSaveCredentials(e.target.checked)}
   />
   ```

3. **æä¾›è·å– Token çš„å¸®åŠ©é“¾æ¥**
   ```tsx
   <Button
     component='a'
     href='https://open.feishu.cn/document/...'
     target='_blank'
   >
     å¦‚ä½•è·å– User Access Tokenï¼Ÿ
   </Button>
   ```

### æ–¹æ¡ˆäºŒï¼šæ·»åŠ ç³»ç»Ÿçº§é…ç½®ï¼ˆæ¨èï¼‰

**é€‚åˆåœºæ™¯**ï¼šé¢‘ç¹å¯¼å…¥ã€ä¼ä¸šå†…éƒ¨ä½¿ç”¨

**å®ç°æ­¥éª¤**ï¼š

#### 1. æ·»åŠ ç³»ç»Ÿé…ç½®ç•Œé¢

**ä½ç½®**ï¼šçŸ¥è¯†åº“è®¾ç½® > é£ä¹¦æ–‡æ¡£å¯¼å…¥

```typescript
// web/admin/src/pages/setting/component/CardFeishuImport.tsx
interface FeishuImportSetting {
  feishu_import_is_enabled: boolean;
  feishu_import_app_id: string;
  feishu_import_app_secret: string;
  feishu_import_user_access_token: string;
}
```

#### 2. ä¿®æ”¹å¯¼å…¥æµç¨‹

```typescript
// æ£€æŸ¥æ˜¯å¦æœ‰ç³»ç»Ÿé…ç½®
const systemConfig = await getFeishuImportConfig(kb_id);

if (systemConfig?.feishu_import_is_enabled) {
  // ä½¿ç”¨ç³»ç»Ÿé…ç½®
  const resp = await postApiV1CrawlerParse({
    crawler_source: type,
    feishu_setting: {
      app_id: systemConfig.feishu_import_app_id,
      app_secret: systemConfig.feishu_import_app_secret,
      user_access_token: systemConfig.feishu_import_user_access_token,
    },
    kb_id,
  });
} else {
  // ä½¿ç”¨ç”¨æˆ·è¾“å…¥ï¼ˆå½“å‰é€»è¾‘ï¼‰
  // æ˜¾ç¤ºè¡¨å•è®©ç”¨æˆ·è¾“å…¥
}
```

#### 3. æä¾›åˆ‡æ¢é€‰é¡¹

```tsx
<FormControlLabel
  control={<Radio />}
  label="ä½¿ç”¨ç³»ç»Ÿé…ç½®"
  value="system"
/>
<FormControlLabel
  control={<Radio />}
  label="ä½¿ç”¨è‡ªå®šä¹‰é…ç½®"
  value="custom"
/>
```

### æ–¹æ¡ˆä¸‰ï¼šæ··åˆæ¨¡å¼ï¼ˆæœ€ä½³ï¼‰

**ç»“åˆä¸¤ç§æ–¹å¼çš„ä¼˜ç‚¹**

```typescript
// é…ç½®ä¼˜å…ˆçº§
const getFeishuCredentials = async () => {
  // 1. ä¼˜å…ˆä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰ï¼ˆå¦‚æœå¡«å†™äº†ï¼‰
  if (formData.app_id && formData.app_secret && formData.user_access_token) {
    return formData;
  }
  
  // 2. å…¶æ¬¡ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜
  const cached = localStorage.getItem('feishu_credentials');
  if (cached) {
    const credentials = JSON.parse(cached);
    // æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼ˆä¾‹å¦‚ 7 å¤©ï¼‰
    if (Date.now() - credentials.saved_at < 7 * 24 * 60 * 60 * 1000) {
      return credentials;
    }
  }
  
  // 3. æœ€åä½¿ç”¨ç³»ç»Ÿé…ç½®
  const systemConfig = await getFeishuImportConfig(kb_id);
  if (systemConfig?.feishu_import_is_enabled) {
    return {
      app_id: systemConfig.feishu_import_app_id,
      app_secret: systemConfig.feishu_import_app_secret,
      user_access_token: systemConfig.feishu_import_user_access_token,
    };
  }
  
  // 4. éƒ½æ²¡æœ‰ï¼Œæç¤ºç”¨æˆ·è¾“å…¥
  return null;
};
```

---

## äº”ã€User Access Token è·å–æ–¹æ¡ˆ

### 5.1 é—®é¢˜åˆ†æ

User Access Token æ˜¯æœ€éš¾è·å–çš„å‚æ•°ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

#### æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨è·å–ï¼ˆå½“å‰ï¼‰

**æ­¥éª¤**ï¼š
1. åœ¨é£ä¹¦å¼€æ”¾å¹³å°åˆ›å»ºåº”ç”¨
2. é…ç½®æƒé™èŒƒå›´
3. é€šè¿‡ OAuth æµç¨‹è·å– code
4. ç”¨ code æ¢å– access_token

**ç¼ºç‚¹**ï¼šå¤æ‚ï¼Œç”¨æˆ·éš¾ä»¥æ“ä½œ

#### æ–¹å¼äºŒï¼šOAuth æˆæƒï¼ˆæ¨èï¼‰

**å®ç°æµç¨‹**ï¼š

```typescript
// 1. ç”¨æˆ·ç‚¹å‡»"æˆæƒé£ä¹¦è´¦å·"
const handleFeishuAuth = () => {
  const authUrl = `https://open.feishu.cn/open-apis/authen/v1/authorize?
    app_id=${formData.app_id}&
    redirect_uri=${encodeURIComponent(callbackUrl)}&
    scope=docs:read&
    state=${state}`;
  
  window.open(authUrl, '_blank');
};

// 2. å›è°ƒå¤„ç†
const handleCallback = async (code: string) => {
  // åç«¯ç”¨ code æ¢å– access_token
  const resp = await postApiV1FeishuGetToken({
    app_id: formData.app_id,
    app_secret: formData.app_secret,
    code: code,
  });
  
  setFormData({
    ...formData,
    user_access_token: resp.access_token,
  });
};
```

#### æ–¹å¼ä¸‰ï¼šåº”ç”¨çº§ Tokenï¼ˆç®€åŒ–ç‰ˆï¼‰

å¦‚æœåªéœ€è¦è®¿é—®å…¬å¼€æ–‡æ¡£ï¼Œå¯ä»¥ä½¿ç”¨ tenant_access_tokenï¼š

```go
// åç«¯è‡ªåŠ¨è·å–
func (u *CrawlerUsecase) getFeishuTenantToken(appID, appSecret string) (string, error) {
    // è°ƒç”¨é£ä¹¦ API è·å– tenant_access_token
    resp, err := http.Post(
        "https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal",
        "application/json",
        bytes.NewBuffer([]byte(fmt.Sprintf(`{
            "app_id": "%s",
            "app_secret": "%s"
        }`, appID, appSecret))),
    )
    // ...
    return token, nil
}
```

**ä¼˜ç‚¹**ï¼šç”¨æˆ·åªéœ€æä¾› App ID å’Œ App Secret

---

## å…­ã€å®æ–½å»ºè®®

### 6.1 çŸ­æœŸæ–¹æ¡ˆï¼ˆ1-2 å¤©ï¼‰

**ç›®æ ‡**ï¼šä¼˜åŒ–ç°æœ‰ä½“éªŒ

1. âœ… æ·»åŠ æµè§ˆå™¨æœ¬åœ°å­˜å‚¨
2. âœ… æ·»åŠ "è®°ä½å‡­è¯"é€‰é¡¹
3. âœ… ä¼˜åŒ–è¡¨å•æç¤ºæ–‡æ¡ˆ
4. âœ… æ·»åŠ è·å– Token çš„å¸®åŠ©æ–‡æ¡£é“¾æ¥

**ä»£ç æ”¹åŠ¨**ï¼š
- ä¿®æ”¹ `FormSubmit/FormInput.tsx`
- æ·»åŠ  localStorage é€»è¾‘
- æ›´æ–° UI æç¤º

### 6.2 ä¸­æœŸæ–¹æ¡ˆï¼ˆ1 å‘¨ï¼‰

**ç›®æ ‡**ï¼šç®€åŒ– Token è·å–

1. âœ… å®ç° OAuth æˆæƒæµç¨‹
2. âœ… æ·»åŠ "ä¸€é”®æˆæƒ"æŒ‰é’®
3. âœ… è‡ªåŠ¨è·å– User Access Token

**ä»£ç æ”¹åŠ¨**ï¼š
- æ·»åŠ  OAuth å›è°ƒæ¥å£
- å®ç° Token äº¤æ¢é€»è¾‘
- æ›´æ–°å‰ç«¯æˆæƒæµç¨‹

### 6.3 é•¿æœŸæ–¹æ¡ˆï¼ˆ2-4 å‘¨ï¼‰

**ç›®æ ‡**ï¼šæ”¯æŒç³»ç»Ÿçº§é…ç½®

1. âœ… æ·»åŠ ç³»ç»Ÿé…ç½®ç•Œé¢
2. âœ… å®ç°æ··åˆé…ç½®æ¨¡å¼
3. âœ… æ”¯æŒå®šæœŸè‡ªåŠ¨åŒæ­¥
4. âœ… æ·»åŠ å¯¼å…¥å†å²è®°å½•

**ä»£ç æ”¹åŠ¨**ï¼š
- æ·»åŠ é…ç½®ç®¡ç†é¡µé¢
- ä¿®æ”¹åç«¯å­˜å‚¨é€»è¾‘
- å®ç°å®šæ—¶ä»»åŠ¡

---

## ä¸ƒã€æŠ€æœ¯å®ç°ç»†èŠ‚

### 7.1 é£ä¹¦ API è°ƒç”¨

PandaWiki ä½¿ç”¨ `anydocClient` è°ƒç”¨é£ä¹¦ APIï¼š

```go
docs, err = u.anydocClient.FeishuListDocs(
    ctx, 
    id, 
    req.FeishuSetting.AppID, 
    req.FeishuSetting.AppSecret, 
    req.FeishuSetting.UserAccessToken, 
    req.FeishuSetting.SpaceId
)
```

**æ¶‰åŠçš„é£ä¹¦ API**ï¼š
- è·å–æ–‡æ¡£åˆ—è¡¨ï¼š`/open-apis/drive/v1/files`
- è·å–æ–‡æ¡£å†…å®¹ï¼š`/open-apis/docx/v1/documents/{document_id}/raw_content`
- è·å–æ–‡ä»¶å¤¹ï¼š`/open-apis/drive/v1/folders/{folder_token}/children`

### 7.2 æ•°æ®ç»“æ„

```typescript
interface FeishuSetting {
  app_id: string;
  app_secret: string;
  user_access_token: string;
  space_id?: string;  // å¯é€‰ï¼ŒæŒ‡å®šçŸ¥è¯†ç©ºé—´
}

interface CrawlerParseRequest {
  crawler_source: 'feishu';
  feishu_setting: FeishuSetting;
  kb_id: string;
}
```

### 7.3 æƒé™è¦æ±‚

é£ä¹¦åº”ç”¨éœ€è¦ç”³è¯·ä»¥ä¸‹æƒé™ï¼š
- `docs:read` - è¯»å–æ–‡æ¡£
- `drive:read` - è¯»å–äº‘ç›˜æ–‡ä»¶
- `wiki:read` - è¯»å–çŸ¥è¯†åº“ï¼ˆå¯é€‰ï¼‰

---

## å…«ã€æ€»ç»“ä¸å»ºè®®

### 8.1 å›ç­”ä½ çš„é—®é¢˜

> **èƒ½å¦å®ç°é£ä¹¦çš„æ–‡æ¡£å¯¼å…¥ï¼Ÿ**

âœ… **å·²ç»å®ç°äº†ï¼** PandaWiki å·²ç»æ”¯æŒé£ä¹¦æ–‡æ¡£å¯¼å…¥åŠŸèƒ½ã€‚

> **è¿™ä¸ªåŠŸèƒ½å®ç°æ˜¯ç”¨æˆ·è‡ªå·±é…ç½®è¿˜æ˜¯ç³»ç»Ÿé…ç½®ä¸€æ¬¡å³å¯ï¼Ÿ**

ğŸ“Œ **å½“å‰æ˜¯ç”¨æˆ·é…ç½®**ï¼ˆæ¯æ¬¡å¯¼å…¥æ—¶è¾“å…¥å‡­è¯ï¼‰

**å»ºè®®é‡‡ç”¨æ··åˆæ¨¡å¼**ï¼š
- âœ… ä¿ç•™ç”¨æˆ·è‡ªå®šä¹‰é…ç½®ï¼ˆçµæ´»æ€§ï¼‰
- âœ… æ·»åŠ ç³»ç»Ÿçº§é…ç½®é€‰é¡¹ï¼ˆä¾¿æ·æ€§ï¼‰
- âœ… æ”¯æŒæµè§ˆå™¨ç¼“å­˜ï¼ˆç”¨æˆ·ä½“éªŒï¼‰
- âœ… æä¾› OAuth æˆæƒï¼ˆç®€åŒ–æ“ä½œï¼‰

### 8.2 æœ€ä½³å®è·µ

**å¯¹äºä¼ä¸šå†…éƒ¨ä½¿ç”¨**ï¼š
1. ç®¡ç†å‘˜åœ¨ç³»ç»Ÿä¸­é…ç½®ä¸€æ¬¡é£ä¹¦åº”ç”¨å‡­è¯
2. æ‰€æœ‰ç”¨æˆ·ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€é‡å¤è¾“å…¥
3. å®šæœŸè‡ªåŠ¨åŒæ­¥é£ä¹¦æ–‡æ¡£

**å¯¹äºå¤šç§Ÿæˆ·/SaaS åœºæ™¯**ï¼š
1. æ¯ä¸ªç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„é£ä¹¦è´¦å·
2. é€šè¿‡ OAuth æˆæƒç®€åŒ–æ“ä½œ
3. æµè§ˆå™¨ç¼“å­˜å‡­è¯æå‡ä½“éªŒ

### 8.3 å¼€å‘ä¼˜å…ˆçº§

**P0ï¼ˆå¿…é¡»ï¼‰**ï¼š
- âœ… å·²å®ç°åŸºç¡€å¯¼å…¥åŠŸèƒ½

**P1ï¼ˆæ¨èï¼‰**ï¼š
- ğŸ”§ æ·»åŠ æµè§ˆå™¨æœ¬åœ°å­˜å‚¨
- ğŸ”§ å®ç° OAuth æˆæƒæµç¨‹
- ğŸ”§ ä¼˜åŒ–é”™è¯¯æç¤º

**P2ï¼ˆå¯é€‰ï¼‰**ï¼š
- ğŸ“‹ æ·»åŠ ç³»ç»Ÿçº§é…ç½®
- ğŸ“‹ æ”¯æŒå®šæœŸè‡ªåŠ¨åŒæ­¥
- ğŸ“‹ æ·»åŠ å¯¼å…¥å†å²è®°å½•

---

## ä¹ã€å‚è€ƒèµ„æº

1. **PandaWiki æ–‡æ¡£**ï¼šhttps://pandawiki.docs.baizhi.cloud/node/01976929-0e76-77a9-aed9-842e60933464#é€šè¿‡é£ä¹¦æ–‡æ¡£å¯¼å…¥
2. **é£ä¹¦å¼€æ”¾å¹³å°**ï¼šhttps://open.feishu.cn/
3. **é£ä¹¦æ–‡æ¡£ API**ï¼šhttps://open.feishu.cn/document/server-docs/docs/docs/docx-v1/document
4. **é£ä¹¦ OAuth æ–‡æ¡£**ï¼šhttps://open.feishu.cn/document/common-capabilities/sso/api/get-user-info

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**ï¼š2025-11-25  
**åˆ†æå·¥å…·**ï¼šKiro AI Assistant

# 标题自动编号快速测试指南

## 测试目标

验证 PRD 核心要求：**任何层级在缺失父级时，均从 1 开始，禁止出现"0.x"形态**

## 测试步骤

### 测试 1：只有 H2 标题（无父级 H1）

**操作：**
1. 创建有序列表
2. 在第一个列表项中插入 H2 标题，输入 "第一节"
3. 在第二个列表项中插入 H2 标题，输入 "第二节"
4. 在第三个列表项中插入 H2 标题，输入 "第三节"

**预期结果：**
```
1. 第一节
2. 第二节
3. 第三节
```

**❌ 错误结果（修复前）：**
```
0.1 第一节
0.2 第二节
0.3 第三节
```

---

### 测试 2：只有 H3 标题（无父级 H1 和 H2）

**操作：**
1. 创建有序列表
2. 在列表项中插入 H3 标题，输入 "第一小节"
3. 继续插入 H3 标题，输入 "第二小节"

**预期结果：**
```
1. 第一小节
2. 第二小节
```

**❌ 错误结果（修复前）：**
```
0.0.1 第一小节
0.0.2 第二小节
```

---

### 测试 3：H2 和 H3 混合（无父级 H1）

**操作：**
1. 创建有序列表
2. 插入 H2 标题 "第一节"
3. 插入 H3 标题 "第一小节"
4. 插入 H3 标题 "第二小节"
5. 插入 H2 标题 "第二节"
6. 插入 H3 标题 "第一小节"

**预期结果：**
```
1. 第一节
  1.1 第一小节
  1.2 第二小节
2. 第二节
  2.1 第一小节
```

**❌ 错误结果（修复前）：**
```
0.1 第一节
  0.1.1 第一小节
  0.1.2 第二小节
0.2 第二节
  0.2.1 第一小节
```

---

### 测试 4：H1 和 H3 混合（无 H2）

**操作：**
1. 创建有序列表
2. 插入 H1 标题 "第一章"
3. 插入 H3 标题 "第一小节"（跳过 H2）
4. 插入 H3 标题 "第二小节"
5. 插入 H1 标题 "第二章"
6. 插入 H3 标题 "第一小节"

**预期结果：**
```
1. 第一章
  1.1 第一小节
  1.2 第二小节
2. 第二章
  2.1 第一小节
```

---

### 测试 5：完整层级（H1、H2、H3 都有）

**操作：**
1. 创建有序列表
2. 插入 H1 标题 "第一章"
3. 插入 H2 标题 "第一节"
4. 插入 H3 标题 "第一小节"
5. 插入 H3 标题 "第二小节"
6. 插入 H2 标题 "第二节"
7. 插入 H1 标题 "第二章"

**预期结果：**
```
1. 第一章
  1.1 第一节
    1.1.1 第一小节
    1.1.2 第二小节
  1.2 第二节
2. 第二章
```

---

### 测试 6：动态添加父级标题

**操作：**
1. 创建有序列表，只插入 H2 标题 "第一节"
2. 验证显示为 "1. 第一节"
3. 在第一个列表项前插入新列表项
4. 在新列表项中插入 H1 标题 "第一章"
5. 验证编号自动更新

**预期结果：**
```
步骤 2：
1. 第一节

步骤 5：
1. 第一章
  1.1 第一节  ← 自动更新为二级编号
```

---

### 测试 7：删除父级标题

**操作：**
1. 创建完整层级：H1 "第一章" → H2 "第一节" → H3 "第一小节"
2. 删除 H1 标题
3. 验证 H2 和 H3 的编号变化

**预期结果：**
```
删除前：
1. 第一章
  1.1 第一节
    1.1.1 第一小节

删除后：
1. 第一节      ← H2 变为一级编号
  1.1 第一小节  ← H3 变为二级编号
```

---

## 验收标准

✅ **通过条件：**
- 所有测试场景中，编号不出现 "0.x" 或 "0.0.x" 形态
- 缺失父级时，标题从 "1." 开始编号
- 添加或删除父级标题后，编号自动正确更新

❌ **失败条件：**
- 任何场景出现 "0.x" 编号
- 编号不连续（如 1, 3, 4 跳过 2）
- 添加/删除标题后编号不更新

---

## 快速验证命令

如果你想快速验证，可以在浏览器控制台运行：

```javascript
// 检查是否有 "0." 开头的编号
const numbers = Array.from(document.querySelectorAll('.tiptap ol li h1::before, .tiptap ol li h2::before, .tiptap ol li h3::before'))
  .map(el => window.getComputedStyle(el, '::before').content);

const hasZeroPrefix = numbers.some(n => n.startsWith('"0.') || n.startsWith('"0 '));

if (hasZeroPrefix) {
  console.error('❌ 发现 0.x 编号！', numbers);
} else {
  console.log('✅ 所有编号正常！', numbers);
}
```

---

## 注意事项

1. **浏览器兼容性**：确保在 Chrome、Firefox、Safari 中测试
2. **CSS 缓存**：如果修改后没有生效，清除浏览器缓存或强制刷新（Ctrl+Shift+R）
3. **协作模式**：在多人协作时也要验证编号同步是否正确

---

## 问题排查

### 问题：编号仍然显示 "0.1"

**可能原因：**
1. CSS 文件未更新 → 清除缓存并重新构建
2. 浏览器不支持 `:has()` 选择器 → 升级浏览器到最新版本
3. 样式被其他 CSS 覆盖 → 检查开发者工具中的样式优先级

**解决方法：**
```bash
# 重新构建客户端
cd apps/client
pnpm build

# 或者在开发模式下重启
pnpm dev
```

### 问题：编号不更新

**可能原因：**
- CSS Counter 没有正确重置

**解决方法：**
- 刷新页面
- 检查 `.tiptap ol` 的 `counter-reset` 属性是否正确应用

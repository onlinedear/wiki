# 飞书子文档导入 - 当前限制说明

## 问题分析

经过测试，发现飞书的 Wiki API 返回 404 错误，说明当前使用的 API 端点不存在或不可用。

### 测试结果

```
📚 Wiki search API failed: Request failed with status code 404
📚 Error response: status=404, data="404 page not found"
📚 Wiki get_node API failed: Request failed with status code 404
📚 Drive API failed: Request failed with status code 404
```

## 原因分析

飞书的知识库文档树结构可能：

1. **不通过公开 API 提供** - 知识库的层级关系可能只在飞书 UI 中维护
2. **需要特殊的 API 端点** - 可能有其他未文档化的 API
3. **需要不同的权限** - 可能需要更高级别的企业权限
4. **使用不同的数据模型** - 文档之间的父子关系可能不是通过 API 暴露的

## 当前可用的方案

### 方案 1：手动导入每个文档（推荐）

由于无法自动获取子文档列表，建议：

1. 手动导入每个文档
   - 导入"Chat 聊天"
   - 导入"模型选择"
   - 导入"Autopilot"

2. 在 NoteDoc 中手动建立父子关系
   - 将"模型选择"和"Autopilot"拖动到"Chat 聊天"下

### 方案 2：导入文档内的链接

如果在飞书文档内容中添加了子文档的链接，可以：

1. 在"Chat 聊天"文档中添加指向子文档的链接
2. 代码会识别这些链接并导入（需要实现）

### 方案 3：使用飞书导出功能

1. 在飞书中导出整个知识库为 Markdown 或 HTML
2. 使用 NoteDoc 的批量导入功能
3. 手动重建文档结构

## 技术限制

### 飞书 API 的限制

根据测试，以下 API 不可用或不适用：

1. `/wiki/v2/spaces/search` - 404 Not Found
2. `/wiki/v2/spaces/get_node` - 404 Not Found  
3. `/wiki/v2/spaces/list` - 未测试（需要 node_token）
4. `/drive/v1/files/{token}/children` - 404 Not Found

### 可能的原因

1. **API 版本问题** - 这些 API 可能已废弃或更改
2. **权限不足** - 即使配置了 `wiki:wiki:readonly`，可能还需要其他权限
3. **文档类型不匹配** - 知识库文档可能使用不同的 API 体系
4. **企业版功能** - 可能只有企业版才能访问这些 API

## 替代方案探索

### 1. 查看飞书开放平台文档

访问飞书开放平台，查找：
- 知识库相关 API
- 文档树结构 API
- 文档关系 API

链接：https://open.feishu.cn/document/

### 2. 联系飞书技术支持

询问：
- 如何通过 API 获取知识库的文档树结构
- 如何获取文档的子文档列表
- 是否有相关的 API 文档

### 3. 使用飞书 Webhook

如果飞书支持 Webhook，可以：
- 监听文档创建事件
- 获取文档关系信息
- 自动同步到 NoteDoc

## 建议

### 短期方案

**手动导入 + 手动组织结构**

这是目前最可行的方案：
1. 逐个导入飞书文档
2. 在 NoteDoc 中手动建立父子关系
3. 文档内容会完整保留（包括格式、图片、视频）

### 长期方案

**等待飞书 API 支持或寻找替代方案**

1. 持续关注飞书 API 更新
2. 探索其他获取文档关系的方式
3. 考虑使用飞书的导出功能 + 批量导入

## 已实现的功能

虽然子文档自动导入不可用，但以下功能已完整实现：

✅ **单文档导入**
- 文本格式完整保留
- 图片自动下载
- 视频自动下载
- 代码块、列表、引用等格式支持

✅ **媒体处理**
- 图片：自动下载并保存
- 视频：自动下载并保存，最大宽度 820px
- 附件：创建完整的附件记录

✅ **格式转换**
- 标题（H1-H6）
- 列表（有序、无序）
- 代码块
- 引用块
- 任务列表
- 高亮块

## 总结

**子文档自动导入功能暂时无法实现**，原因是飞书的 Wiki API 不可用或需要特殊配置。

**推荐使用手动导入方式**：
1. 逐个导入每个文档
2. 在 NoteDoc 中手动组织结构
3. 所有文档内容会完整保留

这不是代码问题，而是飞书 API 的限制。如果未来飞书提供了相关 API，可以很容易地添加这个功能。

---

**创建时间**：2025-11-26  
**状态**：功能受限于飞书 API
**建议**：使用手动导入方式

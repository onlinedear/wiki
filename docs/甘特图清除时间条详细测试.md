# 甘特图清除时间条 - 详细测试说明

## 预期行为

当点击右键菜单的"清除时间条"后，应该出现以下效果：

### ✅ 应该保留的内容

1. **左侧任务列表**
   - 任务序号（如：1, 2, 3）
   - 任务名称
   - 所有自定义字段的值
   - 任务行的背景色

2. **右侧时间轴区域**
   - 顶部的年月标题（如：2025年11月）
   - 第二行的日期标题（如：1, 2, 3...）
   - 每个任务行的背景格子（竖线分隔的格子）
   - 周末的灰色背景
   - 今天的蓝色标记线

### ❌ 应该消失的内容

1. **进度条本身**
   - 蓝色的进度条
   - 进度条上的任务名称
   - 进度条上的天数显示
   - 进度条两端的调整手柄

## 当前问题排查

如果你遇到以下问题，请按照步骤排查：

### 问题 1：背景格子消失了

**检查步骤**：
1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签
3. 查看是否有 JavaScript 错误
4. 如果有错误，记录错误信息

**可能原因**：
- 渲染逻辑出错
- CSS 样式问题
- 数据状态异常

### 问题 2：任务名称消失了

**这不应该发生！**

如果任务名称消失了，说明代码有严重问题。

**检查步骤**：
1. 刷新页面
2. 重新测试
3. 如果问题依然存在，查看控制台错误

### 问题 3：进度条错位显示

**这也不应该发生！**

清除时间条后，进度条应该完全消失，不应该有任何残留。

**可能原因**：
- 条件判断没有生效
- 数据没有正确更新
- 缓存问题

## 详细测试步骤

### 步骤 1：准备测试环境

1. 确保甘特图中至少有 3 个任务
2. 每个任务都有开始日期和结束日期
3. 每个任务都有进度条显示

### 步骤 2：清除第一个任务的时间条

1. 在第一个任务的进度条上右键点击
2. 选择"清除时间条"
3. 观察变化

**预期结果**：
- ✅ 第一个任务的进度条消失
- ✅ 第一个任务的名称仍在左侧列表中
- ✅ 第一个任务行的背景格子仍然显示
- ✅ 其他任务不受影响

### 步骤 3：验证背景格子

**检查项**：
- [ ] 顶部年月标题正常显示
- [ ] 第二行日期标题正常显示
- [ ] 第一个任务行有背景格子（竖线分隔）
- [ ] 周末格子有灰色背景
- [ ] 今天的蓝色标记线正常显示

### 步骤 4：验证任务列表

**检查项**：
- [ ] 第一个任务的序号显示（1）
- [ ] 第一个任务的名称显示
- [ ] 第一个任务的自定义字段值显示
- [ ] 第一个任务行可以点击

### 步骤 5：验证进度条消失

**检查项**：
- [ ] 第一个任务的进度条完全消失
- [ ] 没有任何蓝色条残留
- [ ] 没有任务名称显示在时间轴上
- [ ] 没有天数显示在时间轴上

### 步骤 6：重新设置日期

1. 点击第一个任务（左侧列表或右侧空白区域）
2. 在弹出的对话框中设置开始日期和结束日期
3. 点击"保存"

**预期结果**：
- ✅ 进度条重新出现
- ✅ 进度条位置正确
- ✅ 进度条长度正确

## 代码验证

如果问题依然存在，请检查以下代码：

### 检查点 1：条件判断

在 `gantt-view.tsx` 中搜索：
```typescript
if (!task.startDate || !task.endDate) {
  return null;
}
```

这段代码应该在进度条渲染之前，而不是在背景格子渲染之前。

### 检查点 2：背景格子渲染

在进度条渲染之前，应该有这段代码：
```typescript
{(viewMode === 'week' || viewMode === 'month' || viewMode === 'quarter') && dateColumns.map((date, i) => (
  <Box 
    key={i} 
    className={`${classes.dateCell} ${isWeekend(date) ? classes.weekend : ''}`}
    style={{ width: `${columnWidth}px` }}
  />
))}
```

这段代码应该在所有任务行中都存在，不受日期条件的影响。

### 检查点 3：任务行渲染

每个任务都应该有一个 `taskRow`，无论是否有日期：
```typescript
{!isCollapsed && group.tasks.map((task) => (
  <Box key={task.id} className={classes.taskRow}>
    {/* 背景格子 */}
    {/* 进度条（有条件） */}
  </Box>
))}
```

## 问题报告模板

如果问题依然存在，请提供以下信息：

```
问题描述：
- 清除时间条后，[具体描述发生了什么]

预期行为：
- [描述应该发生什么]

实际行为：
- [描述实际发生了什么]

浏览器：
- [Chrome/Firefox/Safari/Edge]
- 版本：[版本号]

控制台错误：
- [粘贴控制台的错误信息]

截图：
- [如果可能，提供截图]
```

## 临时解决方案

如果清除时间条功能有问题，可以使用以下替代方案：

### 方案 1：手动清除日期

1. 点击任务打开详情对话框
2. 手动删除开始日期和结束日期
3. 点击"保存"

### 方案 2：使用撤销功能

如果清除后出现问题：
1. 立即使用撤销功能（Ctrl+Z / Cmd+Z）
2. 恢复到清除前的状态

### 方案 3：刷新页面

如果界面显示异常：
1. 保存文档
2. 刷新页面（F5）
3. 重新测试

## 下一步

如果所有测试都通过，说明功能正常。

如果测试失败，请：
1. 记录详细的问题描述
2. 提供控制台错误信息
3. 提供截图（如果可能）
4. 联系技术支持

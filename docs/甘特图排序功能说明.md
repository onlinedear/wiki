# 甘特图排序功能说明

## 功能概述

甘特图新增了灵活的排序功能，支持对任务列表按照不同字段进行单条件或多条件排序。排序功能仅在本地生效，不会影响其他协作者的视图。

## 功能特性

### 1. 多条件排序

- 支持添加多个排序条件
- 可通过拖拽调整排序条件的优先级
- 按照条件顺序依次进行排序比较

### 2. 自动排序开关

- 提供"自动排序"开关，可随时启用或禁用排序
- 关闭自动排序后，任务将恢复原始顺序
- 排序条件会被保留，重新开启时立即生效

### 3. 智能排序规则

根据不同字段类型，采用不同的排序逻辑：

#### 文本字段
- **正序 (A → Z)**：按字母顺序排序
- **倒序 (Z → A)**：按字母倒序排序
- **中文支持**：中文按拼音首字母排序
- 示例：任务名、备注等文本字段

#### 数字字段
- **正序 (0 → 9)**：从小到大排序
- **倒序 (9 → 0)**：从大到小排序
- 示例：数字、金额等数值字段

#### 日期字段
- **正序 (0 → 9)**：从早到晚排序
- **倒序 (9 → 0)**：从晚到早排序
- 示例：开始日期、截止日期等

#### 单选字段
- **选项顺序**：按照选项定义的顺序排序
- **选项倒序**：按照选项定义的倒序排序
- 示例：状态、优先级等单选字段

#### 多选字段
- **选项顺序**：按照第一个选中选项的顺序排序
- **选项倒序**：按照第一个选中选项的倒序排序
- 示例：标签、分类等多选字段

#### 人员字段
- **正序 (A → Z)**：按照人员姓名排序
- **倒序 (Z → A)**：按照人员姓名倒序排序

#### 复选框字段
- **顺序**：已选中排在前面
- **倒序**：未选中排在前面

### 4. 空值处理

- 空值（null、undefined、空字符串）统一排在最后
- 无论正序还是倒序，空值始终在末尾

## 使用方法

### 打开排序面板

1. 点击工具栏中的"排序"按钮（<IconArrowsSort />）
2. 如果已有排序条件，按钮会显示为蓝色并标注条件数量

### 添加排序条件

1. 在排序面板中点击"选择条件"按钮
2. 从下拉列表中选择要排序的字段
3. 选择排序方向（正序或倒序）
4. 可以继续添加更多排序条件

### 调整排序优先级

1. 拖动排序条件左侧的拖拽手柄（<IconGripVertical />）
2. 将条件拖动到目标位置
3. 排序会按照从上到下的顺序依次应用

### 修改排序条件

1. 点击字段下拉框可更改排序字段
2. 点击排序方向按钮可切换正序/倒序
3. 点击右侧的删除按钮（<IconX />）可移除该条件

### 清空排序

1. 点击标题栏的"清空全部"按钮
2. 所有排序条件将被移除
3. 任务列表恢复原始顺序

### 启用/禁用自动排序

1. 使用标题栏右侧的"自动排序"开关
2. 关闭后任务恢复原始顺序，但排序条件保留
3. 重新开启后立即应用已设置的排序条件

## 排序示例

### 示例 1：按开始日期排序

1. 添加排序条件
2. 选择字段：开始日期
3. 选择方向：0 → 9（从早到晚）
4. 结果：任务按开始时间从早到晚排列

### 示例 2：多条件排序

1. 第一条件：状态 - 选项顺序
2. 第二条件：开始日期 - 0 → 9
3. 结果：先按状态分组，同一状态内按开始日期排序

### 示例 3：按任务名中文排序

1. 添加排序条件
2. 选择字段：任务名
3. 选择方向：A → Z
4. 结果：中文任务名按拼音首字母排序

## 技术实现

### 排序算法

- 使用 JavaScript 原生的 `Array.sort()` 方法
- 中文排序使用 `String.localeCompare()` 方法，指定 `zh-CN` locale
- 支持多条件级联排序，当前条件相等时比较下一条件

### 状态管理

```typescript
interface SortCondition {
  id: string;           // 条件唯一标识
  fieldId: string;      // 排序字段ID
  direction: 'asc' | 'desc';  // 排序方向
}

const [sortConditions, setSortConditions] = useState<SortCondition[]>([]);
const [autoSort, setAutoSort] = useState(true);
```

### 本地化特性

- 排序仅在客户端进行，不修改服务器数据
- 每个用户可以设置自己的排序条件
- 不影响其他协作者的视图

## 注意事项

1. **本地排序**：排序仅在当前浏览器生效，刷新页面后会重置
2. **与筛选配合**：排序在筛选之后应用，只对筛选后的任务排序
3. **性能考虑**：大量任务时，多条件排序可能略有延迟
4. **空值处理**：空值始终排在最后，避免干扰有效数据的排序

## 未来优化方向

1. 支持保存排序配置到本地存储
2. 支持快速排序预设（如"按日期"、"按状态"等）
3. 支持在列标题上直接点击排序
4. 支持自定义排序规则

## 相关文档

- [甘特图功能说明](./甘特图功能说明.md)
- [甘特图筛选功能说明](./甘特图筛选功能说明.md)
- [甘特图字段配置和设置功能](./甘特图字段配置和设置功能.md)

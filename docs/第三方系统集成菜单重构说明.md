# 第三方系统集成菜单重构说明

## 概述

将 Confluence 集成设置从"个人资料"页面移出，在左侧设置菜单"API 密钥"下方新建"第三方系统集成"菜单项。

## 修改内容

### 1. 新建文件

#### `apps/client/src/pages/settings/integrations/third-party-integrations.tsx`
- 第三方系统集成主页面
- 包含页面标题和描述
- 引入 Confluence 集成组件

#### `apps/client/src/pages/settings/integrations/confluence-integration.tsx`
- Confluence 集成配置组件
- 从原 `confluence-config.tsx` 迁移而来
- 保持所有原有功能不变

### 2. 修改文件

#### `apps/client/src/components/settings/settings-sidebar.tsx`
- 在 Account 分组中添加新菜单项"Third-party integrations"
- 位置：在"API keys"下方
- 图标：`IconPlugConnected`
- 路径：`/settings/account/integrations`

#### `apps/client/src/App.tsx`
- 添加新路由：`/settings/account/integrations`
- 导入 `ThirdPartyIntegrations` 组件

#### `apps/client/src/pages/settings/account/account-settings.tsx`
- 移除 `ConfluenceConfig` 组件导入
- 移除 Confluence 配置部分的渲染
- 移除相关的分隔线

#### 翻译文件
- `apps/client/public/locales/en-US/translation.json`
  - "Third-party integrations": "Third-party integrations"
  - "Manage connections to external systems and services": "Manage connections to external systems and services"

- `apps/client/public/locales/zh-CN/translation.json`
  - "Third-party integrations": "第三方系统集成"
  - "Manage connections to external systems and services": "管理与外部系统和服务的连接"

### 3. 删除文件

#### `apps/client/src/pages/settings/account/confluence-config.tsx`
- 旧的 Confluence 配置组件已删除
- 功能已迁移到新的集成页面

### 4. 验证脚本

创建 `scripts/verify-third-party-integrations.sh` 用于验证功能完整性。

## 功能特性

### 菜单结构
```
设置
└── 账户
    ├── 个人资料
    ├── 偏好设置
    ├── API 密钥
    └── 第三方系统集成 ← 新增
        └── Confluence 集成
```

### 访问路径
- URL: `/settings/account/integrations`
- 菜单位置：设置 → 账户 → 第三方系统集成

### Confluence 集成功能
保持原有所有功能：
- 配置 Confluence URL
- 配置个人访问令牌
- 测试连接
- 保存配置
- 删除配置

## 技术实现

### 组件结构
```
ThirdPartyIntegrations (主页面)
└── ConfluenceIntegration (Confluence 配置)
    ├── 表单验证
    ├── API 调用
    └── 通知反馈
```

### 依赖关系
- 使用 Mantine UI 组件
- 使用 react-i18next 国际化
- 使用现有 Confluence 服务层

## 测试验证

运行验证脚本：
```bash
./scripts/verify-third-party-integrations.sh
```

验证项目：
- ✓ 新文件创建
- ✓ 路由配置
- ✓ 侧边栏菜单
- ✓ 翻译文件
- ✓ TypeScript 语法
- ✓ 旧文件已删除
- ✓ 个人资料页面已清理

## 使用说明

### 开发环境测试
1. 启动开发服务器：
   ```bash
   pnpm client:dev
   ```

2. 访问页面：
   ```
   http://localhost:3000/settings/account/integrations
   ```

3. 验证功能：
   - 查看菜单项是否显示
   - 点击进入配置页面
   - 测试 Confluence 配置功能
   - 确认个人资料页面不再显示 Confluence 配置

### 用户操作流程
1. 登录系统
2. 点击右上角头像 → 设置
3. 在左侧菜单找到"第三方系统集成"
4. 配置 Confluence 连接信息
5. 测试连接并保存

## 后续扩展

该页面设计为可扩展架构，未来可以添加更多第三方系统集成：
- Notion 导入
- Google Drive 集成
- Slack 通知
- 其他文档系统集成

只需在 `third-party-integrations.tsx` 中添加新的集成组件即可。

## 注意事项

1. **向后兼容**：原有 Confluence 配置 API 保持不变
2. **权限控制**：继承原有的用户权限验证
3. **数据迁移**：无需数据迁移，使用现有配置
4. **旧文件清理**：已删除旧的 `confluence-config.tsx` 文件
5. **个人资料页面**：已移除 Confluence 配置部分，保持页面简洁

## 完成状态

- ✅ 新菜单项创建
- ✅ 页面组件实现
- ✅ 路由配置
- ✅ 国际化翻译
- ✅ 验证脚本
- ✅ 文档说明
- ✅ 旧文件清理
- ✅ 个人资料页面更新

## 相关文件

### 新增文件
- 主页面：`apps/client/src/pages/settings/integrations/third-party-integrations.tsx`
- Confluence 组件：`apps/client/src/pages/settings/integrations/confluence-integration.tsx`
- 验证脚本：`scripts/verify-third-party-integrations.sh`

### 修改文件
- 侧边栏：`apps/client/src/components/settings/settings-sidebar.tsx`
- 路由：`apps/client/src/App.tsx`
- 个人资料：`apps/client/src/pages/settings/account/account-settings.tsx`
- 翻译文件：`apps/client/public/locales/*/translation.json`

### 删除文件
- ~~`apps/client/src/pages/settings/account/confluence-config.tsx`~~ (已删除)

# API å¯†é’¥æƒé™æ˜¾ç¤ºç»Ÿä¸€ä¼˜åŒ–ç¡®è®¤

## ç»„ä»¶å¤ç”¨æ¶æ„

ä¸ªäºº API å¯†é’¥å’Œå·¥ä½œåŒº API ç®¡ç†ä½¿ç”¨äº†**åŒä¸€ä¸ªè¡¨æ ¼ç»„ä»¶**ï¼Œå› æ­¤æƒé™æ˜¾ç¤ºä¼˜åŒ–è‡ªåŠ¨åº”ç”¨åˆ°ä¸¤ä¸ªé¡µé¢ã€‚

### ç»„ä»¶ä½¿ç”¨æƒ…å†µ

#### 1. ä¸ªäºº API å¯†é’¥é¡µé¢
**æ–‡ä»¶**: `apps/client/src/pages/settings/account/api-keys.tsx`

```typescript
import { ApiKeyTable } from "@/ee/api-key/components/api-key-table";

// ...

<ApiKeyTable
  apiKeys={filteredApiKeys}
  isLoading={isLoading}
  showUserColumn={false}  // ä¸æ˜¾ç¤ºç”¨æˆ·åˆ—
  onUpdate={handleUpdate}
  onRevoke={handleRevoke}
  onViewDetails={handleViewDetails}
/>
```

#### 2. å·¥ä½œåŒº API ç®¡ç†é¡µé¢
**æ–‡ä»¶**: `apps/client/src/ee/api-key/pages/workspace-api-keys.tsx`

```typescript
import { ApiKeyTable } from "@/ee/api-key/components/api-key-table";

// ...

<ApiKeyTable
  apiKeys={filteredApiKeys}
  isLoading={isLoading}
  showUserColumn  // æ˜¾ç¤ºç”¨æˆ·åˆ—
  onUpdate={handleUpdate}
  onRevoke={handleRevoke}
  onViewDetails={handleViewDetails}
/>
```

### å…±äº«ç»„ä»¶
**æ–‡ä»¶**: `apps/client/src/ee/api-key/components/api-key-table.tsx`

è¿™æ˜¯å”¯ä¸€çš„è¡¨æ ¼ç»„ä»¶å®ç°ï¼ŒåŒ…å«äº†æƒé™åˆ—çš„æ˜¾ç¤ºé€»è¾‘ã€‚

## ä¼˜åŒ–æ•ˆæœ

### âœ… ä¸ªäºº API å¯†é’¥é¡µé¢ (`/settings/account/api-keys`)

**æƒé™åˆ—æ˜¾ç¤ºï¼š**
- å•ä¸ªæƒé™ï¼š`pages:read`
- å¤šä¸ªæƒé™ï¼š`pages:read` `+2`
- é¼ æ ‡æ‚¬åœï¼šæ˜¾ç¤ºå®Œæ•´æƒé™åˆ—è¡¨
- æ— æƒé™ï¼š`å…¨éƒ¨`

**ç‰¹ç‚¹ï¼š**
- ä¸æ˜¾ç¤º"ç”¨æˆ·"åˆ—ï¼ˆ`showUserColumn={false}`ï¼‰
- åªæ˜¾ç¤ºå½“å‰ç”¨æˆ·åˆ›å»ºçš„ API å¯†é’¥

### âœ… å·¥ä½œåŒº API ç®¡ç†é¡µé¢ (`/settings/api-keys`)

**æƒé™åˆ—æ˜¾ç¤ºï¼š**
- å•ä¸ªæƒé™ï¼š`pages:read`
- å¤šä¸ªæƒé™ï¼š`pages:read` `+2`
- é¼ æ ‡æ‚¬åœï¼šæ˜¾ç¤ºå®Œæ•´æƒé™åˆ—è¡¨
- æ— æƒé™ï¼š`å…¨éƒ¨`

**ç‰¹ç‚¹ï¼š**
- æ˜¾ç¤º"ç”¨æˆ·"åˆ—ï¼ˆ`showUserColumn={true}`ï¼‰
- æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·åˆ›å»ºçš„ API å¯†é’¥
- ä»…ç®¡ç†å‘˜å¯è®¿é—®

## ç»„ä»¶å¤ç”¨çš„ä¼˜åŠ¿

### 1. ä»£ç ç»´æŠ¤
- âœ… åªéœ€ä¿®æ”¹ä¸€ä¸ªç»„ä»¶
- âœ… ä¸¤ä¸ªé¡µé¢è‡ªåŠ¨åŒæ­¥æ›´æ–°
- âœ… å‡å°‘ä»£ç é‡å¤
- âœ… é™ä½ç»´æŠ¤æˆæœ¬

### 2. ç”¨æˆ·ä½“éªŒ
- âœ… ä¸¤ä¸ªé¡µé¢çš„äº¤äº’ä¸€è‡´
- âœ… å­¦ä¹ æˆæœ¬ä½
- âœ… è§†è§‰é£æ ¼ç»Ÿä¸€

### 3. åŠŸèƒ½æ‰©å±•
- âœ… æ–°åŠŸèƒ½è‡ªåŠ¨åº”ç”¨åˆ°ä¸¤ä¸ªé¡µé¢
- âœ… Bug ä¿®å¤ä¸€æ¬¡ç”Ÿæ•ˆ
- âœ… æ€§èƒ½ä¼˜åŒ–ç»Ÿä¸€å—ç›Š

## è¡¨æ ¼åˆ—å¯¹æ¯”

| åˆ—å | ä¸ªäºº API å¯†é’¥ | å·¥ä½œåŒº API ç®¡ç† | è¯´æ˜ |
|------|--------------|----------------|------|
| çŠ¶æ€ | âœ… | âœ… | æ˜¾ç¤ºæ´»è·ƒ/è¿‡æœŸçŠ¶æ€ |
| åç§° | âœ… | âœ… | API å¯†é’¥åç§°å’Œæè¿° |
| ç”¨æˆ· | âŒ | âœ… | åˆ›å»ºè€…ä¿¡æ¯ï¼ˆå¤´åƒ+åç§°ï¼‰ |
| æƒé™ | âœ… | âœ… | **å·²ä¼˜åŒ–**ï¼šæ˜¾ç¤ºå®Œæ•´æƒé™ |
| è¯·æ±‚æ•° | âœ… | âœ… | ä½¿ç”¨æ¬¡æ•°ç»Ÿè®¡ |
| æœ€åä½¿ç”¨ | âœ… | âœ… | æœ€åä½¿ç”¨æ—¶é—´ |
| è¿‡æœŸæ—¶é—´ | âœ… | âœ… | è¿‡æœŸæ—¥æœŸæˆ–"æ°¸ä¸" |
| æ“ä½œ | âœ… | âœ… | æŸ¥çœ‹/ç¼–è¾‘/æ’¤é”€ |

## æƒé™æ˜¾ç¤ºè¯¦ç»†è¯´æ˜

### æ˜¾ç¤ºé€»è¾‘

```typescript
{apiKey.scopes && apiKey.scopes.length > 0 ? (
  <Tooltip
    label={
      <div style={{ maxWidth: 300 }}>
        {apiKey.scopes.map((scope, idx) => (
          <div key={idx}>â€¢ {scope}</div>
        ))}
      </div>
    }
    withinPortal
    multiline
  >
    <Group gap={4} style={{ cursor: 'pointer' }}>
      <Badge size="xs" variant="light">
        {apiKey.scopes[0].split(":")[0]}:{apiKey.scopes[0].split(":")[1]}
      </Badge>
      {apiKey.scopes.length > 1 && (
        <Badge size="xs" variant="light" color="gray">
          +{apiKey.scopes.length - 1}
        </Badge>
      )}
    </Group>
  </Tooltip>
) : (
  <Text fz="xs" c="dimmed">
    {t("All")}
  </Text>
)}
```

### æ˜¾ç¤ºç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šå•ä¸ªæƒé™
```
æ•°æ®ï¼š["pages:read"]
æ˜¾ç¤ºï¼š[pages:read]
æ‚¬åœï¼šâ€¢ pages:read
```

#### ç¤ºä¾‹ 2ï¼šä¸¤ä¸ªæƒé™
```
æ•°æ®ï¼š["pages:read", "pages:write"]
æ˜¾ç¤ºï¼š[pages:read] [+1]
æ‚¬åœï¼šâ€¢ pages:read
      â€¢ pages:write
```

#### ç¤ºä¾‹ 3ï¼šå¤šä¸ªæƒé™
```
æ•°æ®ï¼š["pages:read", "pages:write", "pages:delete", "comments:read"]
æ˜¾ç¤ºï¼š[pages:read] [+3]
æ‚¬åœï¼šâ€¢ pages:read
      â€¢ pages:write
      â€¢ pages:delete
      â€¢ comments:read
```

#### ç¤ºä¾‹ 4ï¼šæ— æƒé™é™åˆ¶
```
æ•°æ®ï¼š[] æˆ– null
æ˜¾ç¤ºï¼šå…¨éƒ¨ï¼ˆç°è‰²ï¼‰
æ‚¬åœï¼šæ— 
```

## æµ‹è¯•éªŒè¯æ¸…å•

### ä¸ªäºº API å¯†é’¥é¡µé¢æµ‹è¯•

- [ ] è®¿é—® `/settings/account/api-keys`
- [ ] åˆ›å»ºæœ‰å•ä¸ªæƒé™çš„ API å¯†é’¥
  - [ ] éªŒè¯æƒé™åˆ—æ˜¾ç¤ºå®Œæ•´æ ¼å¼ï¼ˆå¦‚ `pages:read`ï¼‰
  - [ ] éªŒè¯é¼ æ ‡æ‚¬åœæ˜¾ç¤ºæƒé™åˆ—è¡¨
- [ ] åˆ›å»ºæœ‰å¤šä¸ªæƒé™çš„ API å¯†é’¥
  - [ ] éªŒè¯æ˜¾ç¤ºç¬¬ä¸€ä¸ªæƒé™ + `+N` å¾½ç« 
  - [ ] éªŒè¯é¼ æ ‡æ‚¬åœæ˜¾ç¤ºæ‰€æœ‰æƒé™
- [ ] åˆ›å»ºæ— æƒé™é™åˆ¶çš„ API å¯†é’¥
  - [ ] éªŒè¯æ˜¾ç¤º"å…¨éƒ¨"æ–‡æœ¬

### å·¥ä½œåŒº API ç®¡ç†é¡µé¢æµ‹è¯•

- [ ] è®¿é—® `/settings/api-keys`ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
- [ ] åˆ›å»ºæœ‰å•ä¸ªæƒé™çš„ API å¯†é’¥
  - [ ] éªŒè¯æƒé™åˆ—æ˜¾ç¤ºå®Œæ•´æ ¼å¼ï¼ˆå¦‚ `pages:read`ï¼‰
  - [ ] éªŒè¯é¼ æ ‡æ‚¬åœæ˜¾ç¤ºæƒé™åˆ—è¡¨
- [ ] åˆ›å»ºæœ‰å¤šä¸ªæƒé™çš„ API å¯†é’¥
  - [ ] éªŒè¯æ˜¾ç¤ºç¬¬ä¸€ä¸ªæƒé™ + `+N` å¾½ç« 
  - [ ] éªŒè¯é¼ æ ‡æ‚¬åœæ˜¾ç¤ºæ‰€æœ‰æƒé™
- [ ] åˆ›å»ºæ— æƒé™é™åˆ¶çš„ API å¯†é’¥
  - [ ] éªŒè¯æ˜¾ç¤º"å…¨éƒ¨"æ–‡æœ¬
- [ ] éªŒè¯"ç”¨æˆ·"åˆ—æ­£ç¡®æ˜¾ç¤ºåˆ›å»ºè€…ä¿¡æ¯

### è·¨é¡µé¢ä¸€è‡´æ€§æµ‹è¯•

- [ ] åœ¨ä¸ªäººé¡µé¢åˆ›å»º API å¯†é’¥
- [ ] åˆ‡æ¢åˆ°å·¥ä½œåŒºç®¡ç†é¡µé¢
- [ ] éªŒè¯æƒé™æ˜¾ç¤ºæ ¼å¼ä¸€è‡´
- [ ] éªŒè¯ Tooltip è¡Œä¸ºä¸€è‡´

## ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶
- `apps/client/src/ee/api-key/components/api-key-table.tsx` - è¡¨æ ¼ç»„ä»¶ï¼ˆå”¯ä¸€ä¿®æ”¹ï¼‰

### ä½¿ç”¨è¯¥ç»„ä»¶çš„é¡µé¢
- `apps/client/src/pages/settings/account/api-keys.tsx` - ä¸ªäºº API å¯†é’¥é¡µé¢
- `apps/client/src/ee/api-key/pages/workspace-api-keys.tsx` - å·¥ä½œåŒº API ç®¡ç†é¡µé¢

## æ€»ç»“

âœ… **ä¸€æ¬¡ä¿®æ”¹ï¼Œä¸¤å¤„ç”Ÿæ•ˆ**

é€šè¿‡ä¿®æ”¹å…±äº«çš„ `ApiKeyTable` ç»„ä»¶ï¼Œæƒé™æ˜¾ç¤ºä¼˜åŒ–è‡ªåŠ¨åº”ç”¨åˆ°ï¼š
1. ä¸ªäºº API å¯†é’¥é¡µé¢
2. å·¥ä½œåŒº API ç®¡ç†é¡µé¢

è¿™ç§ç»„ä»¶å¤ç”¨çš„æ¶æ„è®¾è®¡ï¼š
- æé«˜äº†ä»£ç è´¨é‡
- é™ä½äº†ç»´æŠ¤æˆæœ¬
- ä¿è¯äº†ç”¨æˆ·ä½“éªŒçš„ä¸€è‡´æ€§
- ç®€åŒ–äº†åŠŸèƒ½æ‰©å±•å’Œ Bug ä¿®å¤

ç°åœ¨ä¸¤ä¸ªé¡µé¢çš„æƒé™åˆ—éƒ½èƒ½æ¸…æ™°åœ°æ˜¾ç¤º API å¯†é’¥çš„æƒé™èŒƒå›´äº†ï¼ğŸ‰

---

**ä¿®æ”¹æ–‡ä»¶**ï¼š`apps/client/src/ee/api-key/components/api-key-table.tsx`

**å½±å“é¡µé¢**ï¼š
- `/settings/account/api-keys` - ä¸ªäºº API å¯†é’¥
- `/settings/api-keys` - å·¥ä½œåŒº API ç®¡ç†

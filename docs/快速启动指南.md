# NoteDoc 快速启动指南

## 当前状态

✅ TypeScript 编译错误已修复
✅ 项目构建成功
⏳ 准备启动服务

## 启动方式

### 方式 1: Docker Compose（推荐）

这是最简单的方式，会自动启动所有依赖服务。

#### 步骤：

1. **启动 Docker Desktop**
   - 在 macOS 上找到并打开 Docker Desktop 应用
   - 或者如果使用 OrbStack，启动 OrbStack

2. **启动所有服务**
   ```bash
   docker-compose up -d
   ```

3. **查看日志**
   ```bash
   docker-compose logs -f notedoc
   ```

4. **访问应用**
   - 打开浏览器访问: http://localhost:3001

5. **停止服务**
   ```bash
   docker-compose down
   ```

### 方式 2: 本地开发模式

如果你想在本地开发和调试，使用这种方式。

#### 前置要求：

1. **启动数据库和 Redis**
   ```bash
   # 只启动数据库和 Redis
   docker-compose up -d db redis
   ```

2. **检查服务状态**
   ```bash
   docker-compose ps
   ```

#### 启动步骤：

1. **运行数据库迁移**
   ```bash
   cd apps/server
   export PATH="$PATH:$(npm config get prefix)/bin"
   pnpm migration:up
   cd ../..
   ```

2. **启动开发服务器**
   ```bash
   export PATH="$PATH:$(npm config get prefix)/bin"
   pnpm dev
   ```

3. **访问应用**
   - 前端: http://localhost:5173
   - 后端: http://localhost:3001

## 环境配置

当前 `.env` 配置：

```env
APP_URL=http://localhost:3001
PORT=3001
DATABASE_URL=postgresql://docmost:STRONG_DB_PASSWORD@localhost:5432/docmost?schema=public
REDIS_URL=redis://127.0.0.1:6379
APP_SECRET=0123456789abcdef0123456789abcdef
```

## 常见问题

### 1. Docker 无法连接

**错误**: `Cannot connect to the Docker daemon`

**解决**: 
- 启动 Docker Desktop 或 OrbStack
- 等待 Docker 完全启动（图标不再转动）

### 2. 端口被占用

**错误**: `port is already allocated`

**解决**:
```bash
# 查看占用端口的进程
lsof -i :3001
lsof -i :5432
lsof -i :6379

# 停止占用的进程或修改 .env 中的端口
```

### 3. 数据库连接失败

**错误**: `Connection refused` 或 `ECONNREFUSED`

**解决**:
- 确保数据库容器正在运行: `docker-compose ps`
- 检查数据库密码是否匹配
- 等待数据库完全启动（约 10-20 秒）

### 4. pnpm 命令找不到

**解决**:
```bash
export PATH="$PATH:$(npm config get prefix)/bin"
# 或者重新安装
npm install -g pnpm@10.4.0
```

## 下一步

启动成功后：

1. **创建管理员账户** - 首次访问会引导你创建
2. **配置工作空间** - 设置名称、Logo 等
3. **测试功能**:
   - 创建文档库
   - 创建文档
   - 测试评论功能
   - 测试 API Key 管理
   - 测试甘特图功能

## 开发命令

```bash
# 构建项目
pnpm build

# 运行测试
pnpm test

# 代码检查
pnpm lint

# 格式化代码
pnpm format

# 查看所有可用命令
pnpm run
```

## 生产部署

参考文档：
- [生产环境部署指南](./生产环境部署指南.md)
- [宝塔面板部署指南](./宝塔面板部署指南.md)
- [Vercel 部署指南](./Vercel部署指南.md)

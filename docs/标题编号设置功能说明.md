# 标题编号设置功能说明

## 功能概述

在有序列表中的标题编号支持交互式设置，用户可以通过点击编号来自定义编号行为。

## 功能特性

### 1. 点击编号弹出菜单

点击任何标题前的编号（如 "1.", "2.1", "1.1.1"），会弹出一个设置菜单，包含以下选项：

### 2. 继续标题编号

- **功能**：恢复自然排序，移除所有自定义编号设置
- **使用场景**：当之前设置了自定义编号，想要恢复正常的连续编号时
- **效果**：
  - 如果之前设置了"从 1. 开始"，会恢复为自然顺序
  - 如果之前设置了自定义值（如 2.3），会恢复为 2.1

### 3. 重新开始编号

点击"重新开始编号"会展开子菜单，提供两个选项：

#### 从 1. 开始
- **功能**：将当前标题的编号重置为 1（或 X.1, X.X.1）
- **效果**：
  - H1 标题：重置为 "1."
  - H2 标题：重置为 "X.1"（保留上级编号）
  - H3 标题：重置为 "X.X.1"（保留上级编号）
- **影响范围**：会影响后续同级标题的编号

#### 从当前编号开始
- **功能**：保持当前编号不变，但重新开始计数
- **使用场景**：想要在文档中间插入新的编号序列
- **效果**：后续同级标题会从这个编号继续递增

### 4. 设置编号的值

- **功能**：自定义当前标题的编号值
- **输入方式**：
  - 数字输入框：直接输入数字
  - 上下按钮：递增或递减数字
- **限制规则**：
  - 一级编号（如 "1."）：可以设置任意数字
  - 多级编号（如 "2.1"）：只能修改最后一级的数字
  - 示例：编号为 "2.1" 时，只能修改 "1" 这部分，变成 "2.2", "2.3" 等
- **影响范围**：会影响后续同级标题的编号

## 使用示例

### 示例 1：重新开始编号

**初始状态：**
```
1. 第一章
2. 第二章
3. 第三章
```

**操作：** 点击 "3." → 选择"重新开始编号" → "从 1. 开始"

**结果：**
```
1. 第一章
2. 第二章
1. 第三章  ← 重新从 1 开始
```

### 示例 2：设置自定义编号

**初始状态：**
```
1. 第一章
   1.1 第一节
   1.2 第二节
2. 第二章
```

**操作：** 点击 "1.2" → 选择"设置编号的值" → 输入 "5"

**结果：**
```
1. 第一章
   1.1 第一节
   1.5 第二节  ← 自定义为 1.5
2. 第二章
```

### 示例 3：恢复自然编号

**初始状态：**
```
1. 第一章
   1.1 第一节
   1.5 第二节  ← 之前自定义的
2. 第二章
```

**操作：** 点击 "1.5" → 选择"继续标题编号"

**结果：**
```
1. 第一章
   1.1 第一节
   1.2 第二节  ← 恢复为自然编号
2. 第二章
```

## 技术实现

### 核心组件

1. **NumberingMenu** (`numbering-menu.tsx`)
   - 编号设置菜单的 UI 组件
   - 提供三个主要功能的交互界面

2. **useNumberingClick** (`use-numbering-click.tsx`)
   - React Hook，监听编号区域的点击事件
   - 计算当前编号值
   - 管理菜单的显示状态

3. **NumberingMenuWrapper** (`numbering-menu-wrapper.tsx`)
   - 包装组件，集成 Hook 和 Menu
   - 在编辑器中使用

### 数据属性

在 ListItem 节点上添加了以下属性：

- `customNumber`: 存储自定义编号值（如 "1", "2.1", "1.1.1"）
- `restartNumbering`: 标记是否重新开始编号
- `headingLevel`: 存储标题级别（1-6）

### CSS 实现

```css
/* 编号可点击 */
.tiptap ol li::before {
  cursor: pointer;
  transition: color 0.2s;
}

/* 悬停效果 */
.tiptap ol li::before:hover {
  color: var(--mantine-color-blue-6);
}

/* 自定义编号 */
.tiptap ol li[data-custom-number]::before {
  content: attr(data-custom-number) " ";
}
```

## 注意事项

1. **编号层级限制**
   - 多级编号只能修改最后一级
   - 例如 "2.1.3" 只能修改 "3" 这部分

2. **影响范围**
   - 自定义编号会影响后续同级标题
   - 不会影响上级或下级标题

3. **编号范围**
   - 最小值：1
   - 最大值：999
   - 只支持正整数

4. **交互提示**
   - 编号悬停时会变色，提示可点击
   - 菜单会显示当前编号值
   - 多级编号会提示只能修改最后一级

## 快捷操作

- **点击编号**：打开设置菜单
- **ESC 键**：关闭菜单
- **点击菜单外**：关闭菜单
- **数字输入**：直接输入数字设置编号
- **上下箭头**：在输入框中递增/递减数字

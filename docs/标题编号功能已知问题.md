# 标题自动编号功能 - 已知问题和限制

## 问题 1：列表项包含多个块级元素

### 问题描述
当一个列表项同时包含段落和标题时（如 `<li><p>热</p><h2>方法方法</h2></li>`），会导致：
1. 显示异常：段落和标题显示在一起
2. 删除困难：无法完全删除内容
3. 编号混乱：编号逻辑无法正确处理

### 原因
这是 Tiptap 编辑器的结构问题。正常情况下，一个列表项应该只包含一个块级元素：
- 要么是 `<li><p>内容</p></li>`
- 要么是 `<li><h2>标题</h2></li>`
- 不应该是 `<li><p>内容</p><h2>标题</h2></li>`

### 如何避免
1. 不要在列表项中间插入标题
2. 如果需要添加标题，先按 Enter 创建新的列表项，然后将其转换为标题
3. 使用工具栏或快捷键来转换整个列表项的类型

### 临时解决方案
如果遇到这种情况：
1. 选中整个异常的列表项
2. 按 Backspace 删除
3. 重新创建正确的结构

## 问题 2：列表类型转换导致编号消失

### 问题描述
将有序列表中的某一项转换为无序列表时，会导致列表拆分，编号可能消失或重新计算。

### 原因
HTML 不允许 `<ol>` 和 `<ul>` 混合，Tiptap 会将列表拆分成多个独立的列表。

### 解决方案
- 标题使用 JavaScript widget 显示自定义编号
- 普通段落使用浏览器默认编号
- 每个独立的列表会重新开始编号

## 问题 3："重新开始编号"子菜单点击无效

### 状态
已修复 - 使用状态控制子菜单的显示和隐藏

## 当前功能限制

### 支持的功能
✅ 标题多级编号（1., 1.1, 1.2.1）
✅ 普通段落简单编号（1., 2., 3.）
✅ 点击编号弹出设置菜单
✅ 继续标题编号
✅ 重新开始编号
✅ 自定义编号值
✅ 级联更新子级编号

### 不支持的功能
❌ 列表项包含多个块级元素
❌ 有序列表和无序列表混合
❌ 跨列表的编号连续性
❌ 普通段落的自定义编号

## 建议的使用方式

1. **保持列表结构简单**
   - 每个列表项只包含一个元素（段落或标题）
   - 不要在列表项中间插入其他块级元素

2. **正确转换列表项类型**
   - 使用工具栏或快捷键转换
   - 不要手动编辑 HTML 结构

3. **标题编号的最佳实践**
   - 使用有序列表包裹标题
   - 保持标题层级的连续性
   - 避免跳级（如从 H1 直接到 H3）

4. **普通段落编号**
   - 使用浏览器默认编号
   - 每个列表独立计数
   - 不支持自定义编号

## 技术说明

### 编号实现方式

**标题编号**：
- 使用 ProseMirror Decoration Widget
- 在 `<h1>` 等标签内部插入 `<span>` 元素
- 支持点击交互和自定义编号

**普通段落编号**：
- 使用浏览器默认的 `list-style-type: decimal`
- 通过 CSS 控制样式
- 不使用 JavaScript widget

### CSS 关键设置

```css
/* 有序列表基础样式 */
.tiptap ol {
  list-style-position: inside;
  padding-left: 0;
}

/* 默认显示编号 */
.tiptap ol li {
  list-style-type: decimal;
}

/* 包含标题的列表项隐藏默认编号 */
.tiptap ol li:has(> h1),
.tiptap ol li:has(> h2),
.tiptap ol li:has(> h3) {
  list-style-type: none;
}

/* 段落内容和编号在同一行 */
.tiptap ol li > p {
  display: inline;
  margin: 0;
}
```

## 未来改进方向

1. **防止异常结构**
   - 添加编辑器插件，阻止创建包含多个块级元素的列表项
   - 自动修复异常结构

2. **改进列表转换**
   - 保持编号的连续性
   - 更智能的列表拆分和合并

3. **增强普通段落编号**
   - 支持自定义起始编号
   - 支持跨列表的连续编号

4. **用户体验优化**
   - 添加编号预览
   - 提供批量编号设置
   - 支持编号模板
